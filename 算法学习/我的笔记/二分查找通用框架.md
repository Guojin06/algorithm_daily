# 二分查找通用框架（血泪总结）

> 来自 Day11 的深度学习成果 - 2小时换来的终身受用框架

---

## 🎯 二分查找5步思维法

### Step 1：明确要找什么
- 第一个？最后一个？
- **找第一个** → `right = mid` + `mid向下取整`
- **找最后一个** → `left = mid` + `mid向上取整`

### Step 2：画出数组的"二段性"
**关键：** 数组能否分成"满足"和"不满足"两段？
```
[满足, 满足, 满足 | 不满足, 不满足]
                ↑ 
            找这个边界
```

### Step 3：定义"满足条件"
**问自己：** 我要找的目标，它和周围元素有什么特征？

### Step 4：判断mid在哪一段
- 如果mid满足条件 → mid在左段还是右段？
- 根据"找第一个/最后一个"决定往哪走

### Step 5：写代码
```cpp
if(条件) {
    // 满足条件时往哪走？
} else {
    // 不满足时往哪走？
}
```

---

## ✅ 二分查找5大检查清单

### 1. 边界安全
- [ ] 访问 `nums[mid+1]` → 确保 `mid < n-1`
- [ ] 访问 `nums[mid-1]` → 确保 `mid > 0`
- [ ] 或改用固定位置比较（`nums[0]`, `nums[n-1]`）

### 2. 区间有效性
- [ ] 二分前检查：`if(left > right) return -1;`
- [ ] 分界点单独处理
- [ ] 边界值 `n` 的定义要清楚（数组大小 or 最后下标）

### 3. 二段性连续
- [ ] 画出条件的二段性：`[✅✅✅|❌❌❌]`
- [ ] 确保不断裂
- [ ] 选对比较对象（相邻 vs 固定位置）

### 4. 模板匹配
- [ ] 找第一个 → `right = mid` + `mid不+1`
- [ ] 找最后一个 → `left = mid` + `mid要+1`
- [ ] 满足条件后往哪走？

### 5. 特殊情况
- [ ] 单元素数组
- [ ] 无旋转的数组（已排序）
- [ ] 目标不存在
- [ ] 分界点就是答案

---

## 📌 两种二分模板

### 模板1：找第一个满足条件的（left boundary）

```cpp
while(left < right) {
    int mid = left + (right - left) / 2;  // 向下取整
    if(满足条件) {
        right = mid;       // 可能是答案，保留mid
    } else {
        left = mid + 1;    // 不满足，跳过mid
    }
}
return left;  // 或 right，此时 left == right
```

**记忆口诀：** 满足条件往左缩 → `right = mid`

---

### 模板2：找最后一个满足条件的（right boundary）

```cpp
while(left < right) {
    int mid = left + (right - left + 1) / 2;  // 向上取整（+1）
    if(满足条件) {
        left = mid;        // 可能是答案，保留mid
    } else {
        right = mid - 1;   // 不满足，跳过mid
    }
}
return left;  // 或 right，此时 left == right
```

**记忆口诀：** 满足条件往右缩 → `left = mid`

---

## 🔥 经典例题对照

### 例1：山峰数组（找任意峰）
```cpp
// 条件：nums[mid] > nums[mid+1]（在下坡）
if(nums[mid] > nums[mid+1]) right = mid;  // 找第一个下坡
else left = mid + 1;
```

### 例2：旋转数组（找唯一峰）
```cpp
// 条件：nums[mid] > nums[n]（比最后一个大）
if(nums[mid] > nums[n]) left = mid;  // 找最后一个大于nums[n]的
else right = mid - 1;
```

**关键区别：**
- 山峰：和相邻元素比 → 任意峰都行
- 旋转：和固定元素比 → 二段性连续

---

## 💡 记忆口诀

**二分五查：**
1. **查越界** - `mid±1` 是否安全
2. **查区间** - 是否为空
3. **查分界** - 分界点是否遗漏
4. **查边界** - 极值是否考虑全
5. **查二段** - 条件是否连续

**模板选择：**
- `right = mid` → 找第一个
- `left = mid` → 找最后一个

**二段性判断：**
- 画出 `[✅✅✅|❌❌❌]`
- 必须连续才能二分

---

## 🎓 常见错误对照

| 错误 | 原因 | 正确做法 |
|------|------|----------|
| 数组越界 | `mid±1` 超出范围 | 用固定位置比较 |
| 死循环 | `left = mid` 但 `mid` 不 `+1` | `mid` 要向上取整 |
| 找不到 | 二段性断裂 | 换比较对象 |
| 分界点错 | 边界没单独处理 | 分界点单独检查 |
| 区间错 | 空区间还访问 | 先判断 `left > right` |

---

**最后提醒：**
- 二分不是背模板，是理解"二段性"
- 画图！画图！画图！（重要的事说三遍）
- 踩坑是好事，每个坑都是经验

**Date:** 2025-10-12  
**Source:** Day11 深度学习成果  
**Status:** 终身受用 ✅

