# Day16 å­¦ä¹ ç¬”è®° - åˆ†æ²»ç®—æ³•ï¼ˆå½’å¹¶æ’åºï¼‰

**æ—¥æœŸï¼š** 2024å¹´10æœˆ17æ—¥  
**ä¸»é¢˜ï¼š** åˆ†æ²»ç®—æ³• - å½’å¹¶æ’åºä¸“é¢˜  
**è¯¾ç¨‹æ¥æºï¼š** æ¯”ç‰¹ç®—æ³•ç²¾å“è¯¾2

---

## ä»Šæ—¥ç›®æ ‡

- [x] æ’åºæ•°ç»„ï¼ˆå½’å¹¶æ’åºï¼‰ - LeetCode 912 âœ…
- [x] è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•° - LeetCode 315 âœ…
- [x] ç¿»è½¬å¯¹ - LeetCode 493 âœ…
- [x] æ•°ç»„ä¸­çš„é€†åºå¯¹ - å‰‘æŒ‡Offer 51 âœ…

**å…¨éƒ¨å®Œæˆï¼** ğŸ‰

---

## 1. æ’åºæ•°ç»„ï¼ˆå½’å¹¶æ’åºï¼‰- LeetCode 912

**é¢˜ç›®é“¾æ¥ï¼š** https://leetcode.cn/problems/sort-an-array/

### é¢˜ç›®æè¿°

ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼Œè¯·ä½ å°†è¯¥æ•°ç»„å‡åºæ’åˆ—ã€‚

**ç¤ºä¾‹1ï¼š**
```
è¾“å…¥ï¼šnums = [5,2,3,1]
è¾“å‡ºï¼š[1,2,3,5]
```

**ç¤ºä¾‹2ï¼š**
```
è¾“å…¥ï¼šnums = [5,1,1,2,0,0]
è¾“å‡ºï¼š[0,0,1,1,2,5]
```

### è§£é¢˜è¿‡ç¨‹

#### åˆå§‹æ€è·¯

å½’å¹¶æ’åºçš„æ ¸å¿ƒæ€æƒ³ï¼šåˆ†æ²» + åˆå¹¶
1. **åˆ†ï¼ˆDivideï¼‰ï¼š** æŠŠæ•°ç»„ä»ä¸­é—´åˆ†æˆä¸¤åŠ
2. **æ²»ï¼ˆConquerï¼‰ï¼š** é€’å½’æ’åºå·¦å³ä¸¤éƒ¨åˆ†
3. **åˆï¼ˆCombineï¼‰ï¼š** åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„

#### ä»£ç æ¡†æ¶

å·²ç»å®Œæˆäº†å‰ä¸¤æ­¥ï¼Œå¡åœ¨äº†ç¬¬ä¸‰æ­¥"åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„"ï¼š

```cpp
class Solution {
public:
    vector<int> sortArray(vector<int>& nums) {
        mergeSort(nums, 0, nums.size() - 1);
        return nums;
    }

    void mergeSort(vector<int>& nums, int left, int right) {
        if(left >= right) return;  // é€’å½’å‡ºå£
        
        // 1. é€‰æ‹©ä¸­é—´ç‚¹åˆ’åˆ†åŒºé—´
        int mid = (left + right) >> 1;
        // [left, mid], [mid+1, right]
        
        // 2. æŠŠå·¦å³åŒºé—´æ’åº
        mergeSort(nums, left, mid);
        mergeSort(nums, mid + 1, right);
        
        // 3. åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„
        // TODO: å¦‚ä½•åˆå¹¶ï¼Ÿ
    }
};
```

#### ç–‘é—®ä¸æ€è€ƒ

**é—®é¢˜ï¼š** å¦‚ä½•åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„ï¼Ÿ

éœ€è¦æ€è€ƒçš„ç‚¹ï¼š
1. ä¸¤ä¸ªæœ‰åºæ•°ç»„åœ¨å“ªé‡Œï¼Ÿå®ƒä»¬çš„èŒƒå›´æ˜¯ä»€ä¹ˆï¼Ÿ
   - ç­”ï¼š`nums[left...mid]` å’Œ `nums[mid+1...right]`
2. ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„æ¥è¾…åŠ©åˆå¹¶ï¼Ÿ
   - ç­”ï¼šä¸´æ—¶æ•°ç»„ `tmp`
3. åˆå¹¶çš„å…·ä½“æ­¥éª¤æ˜¯ä»€ä¹ˆï¼Ÿ
   - ç­”ï¼šåŒæŒ‡é’ˆæ¯”è¾ƒï¼Œè°å°æ”¾è°ï¼Œæœ€åå¤„ç†å‰©ä½™å…ƒç´ 
4. å¦‚ä½•æŠŠåˆå¹¶åçš„ç»“æœå†™å›åŸæ•°ç»„ï¼Ÿ
   - ç­”ï¼šéå†æ‹·è´ `nums[i] = tmp[i]`

#### ACä»£ç ï¼ˆç‰ˆæœ¬1ï¼šå±€éƒ¨tmp - 904msï¼‰

```cpp
class Solution {
public:
    vector<int> sortArray(vector<int>& nums) {
        mergeSort(nums, 0, nums.size() - 1);
        return nums;
    }

    void mergeSort(vector<int>& nums, int left, int right) {
        if(left >= right) return;
        
        // 1. åˆ†ï¼šæ‰¾ä¸­ç‚¹
        int mid = (left + right) >> 1;
        
        // 2. æ²»ï¼šé€’å½’æ’åºå·¦å³
        mergeSort(nums, left, mid);
        mergeSort(nums, mid + 1, right);
        
        // 3. åˆï¼šåˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„
        vector<int> tmp;  // æ¯æ¬¡é€’å½’éƒ½åˆ›å»ºæ–°æ•°ç»„
        int cur1 = left, cur2 = mid + 1;
        
        // æ¯”è¾ƒå¹¶æ”¾å…¥è¾ƒå°çš„
        while(cur1 <= mid && cur2 <= right) {
            if(nums[cur1] <= nums[cur2]) {
                tmp.push_back(nums[cur1++]);
            } else {
                tmp.push_back(nums[cur2++]);
            }
        }
        
        // å¤„ç†å·¦è¾¹å‰©ä½™
        while(cur1 <= mid) {
            tmp.push_back(nums[cur1++]);
        }
        
        // å¤„ç†å³è¾¹å‰©ä½™
        while(cur2 <= right) {
            tmp.push_back(nums[cur2++]);
        }
        
        // æ‹·è´å›åŸæ•°ç»„
        for(int i = left, j = 0; i <= right; i++, j++) {
            nums[i] = tmp[j];
        }
    }
};
```

**æ€§èƒ½é—®é¢˜ï¼š** æ¯æ¬¡é€’å½’éƒ½åˆ›å»ºæ–°çš„ä¸´æ—¶æ•°ç»„ï¼Œå¯¼è‡´é¢‘ç¹çš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾ã€‚

#### ACä»£ç ï¼ˆç‰ˆæœ¬2ï¼šå…¨å±€tmp - 60msï¼‰â­

```cpp
class Solution {
public:
    vector<int> tmp;  // å…¨å±€ä¸´æ—¶æ•°ç»„ï¼Œæ‰€æœ‰é€’å½’å…±ç”¨
    
    vector<int> sortArray(vector<int>& nums) {
        tmp.resize(nums.size());  // é¢„å…ˆåˆ†é…ç©ºé—´ï¼Œåªåˆ†é…ä¸€æ¬¡
        mergeSort(nums, 0, nums.size() - 1);
        return nums;
    }

    void mergeSort(vector<int>& nums, int left, int right) {
        if(left >= right) return;
        
        int mid = (left + right) >> 1;
        mergeSort(nums, left, mid);
        mergeSort(nums, mid + 1, right);
        
        // åˆå¹¶åˆ°å…¨å±€tmp
        int cur1 = left, cur2 = mid + 1;
        int k = left;  // tmpçš„ç´¢å¼•ä¹Ÿä»leftå¼€å§‹
        
        while(cur1 <= mid && cur2 <= right) {
            if(nums[cur1] <= nums[cur2]) {
                tmp[k++] = nums[cur1++];
            } else {
                tmp[k++] = nums[cur2++];
            }
        }
        
        while(cur1 <= mid) tmp[k++] = nums[cur1++];
        while(cur2 <= right) tmp[k++] = nums[cur2++];
        
        // æ‹·è´å›åŸæ•°ç»„ï¼ˆç´¢å¼•å¯¹åº”ï¼‰
        for(int i = left; i <= right; i++) {
            nums[i] = tmp[i];
        }
    }
};
```

**æ€§èƒ½ä¼˜åŒ–ï¼š** ä» 904ms ä¼˜åŒ–åˆ° 60msï¼Œ**å¿«äº†15å€**ï¼

### æ ¸å¿ƒç†è§£

#### 1. å½’å¹¶æ’åºçš„ä¸‰æ­¥éª¤

```
1. åˆ†ï¼ˆDivideï¼‰ï¼š  æ‰¾ä¸­ç‚¹ï¼Œå°†æ•°ç»„åˆ†æˆä¸¤åŠ
2. æ²»ï¼ˆConquerï¼‰ï¼š é€’å½’æ’åºå·¦å³ä¸¤éƒ¨åˆ†
3. åˆï¼ˆCombineï¼‰ï¼š åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„
```

#### 2. é€’å½’å‡ºå£

```cpp
if(left >= right) return;
```
- `left == right`ï¼šåŒºé—´åªæœ‰1ä¸ªå…ƒç´ ï¼Œå·²æœ‰åº
- `left > right`ï¼šç†è®ºä¸Šä¸ä¼šå‡ºç°ï¼Œä½†å†™ `>=` æ›´å®‰å…¨

#### 3. åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„æ ¸å¿ƒ

**åŒæŒ‡é’ˆ + ä¸‰ä¸ªwhileå¾ªç¯ï¼š**
```cpp
// ç¬¬1ä¸ªå¾ªç¯ï¼šä¸¤è¾¹éƒ½æœ‰å…ƒç´ ï¼Œæ¯”è¾ƒå¹¶æ”¾å…¥è¾ƒå°çš„
while(cur1 <= mid && cur2 <= right) { ... }

// ç¬¬2ä¸ªå¾ªç¯ï¼šå¤„ç†å·¦è¾¹å‰©ä½™
while(cur1 <= mid) { ... }

// ç¬¬3ä¸ªå¾ªç¯ï¼šå¤„ç†å³è¾¹å‰©ä½™
while(cur2 <= right) { ... }
```

**æ³¨æ„ï¼š** åä¸¤ä¸ªå¾ªç¯åªæœ‰ä¸€ä¸ªä¼šæ‰§è¡Œï¼

#### 4. ç¨³å®šæ€§ä¿è¯

```cpp
if(nums[cur1] <= nums[cur2])  // ç”¨ <=ï¼Œä¸æ˜¯ <
```

**ä¸ºä»€ä¹ˆç”¨ `<=`ï¼Ÿ**
- ä¿è¯ç¨³å®šæ€§ï¼šç›¸åŒå…ƒç´ çš„ç›¸å¯¹ä½ç½®ä¸å˜
- å¦‚æœç”¨ `<`ï¼Œç›¸åŒå…ƒç´ ä¼šä¼˜å…ˆå–å³è¾¹çš„ï¼Œç ´åç¨³å®šæ€§

#### 5. æ€§èƒ½ä¼˜åŒ–å…³é”®

**å±€éƒ¨tmp vs å…¨å±€tmpï¼š**

| æ–¹æ³• | ç©ºé—´åˆ†é…æ¬¡æ•° | æ—¶é—´ | å…³é”®ç‚¹ |
|------|-------------|------|--------|
| å±€éƒ¨tmp | O(n log n) æ¬¡ | 904ms | æ¯æ¬¡é€’å½’éƒ½åˆ›å»ºæ–°æ•°ç»„ |
| å…¨å±€tmp | 1æ¬¡ | 60ms | æ‰€æœ‰é€’å½’å…±ç”¨ä¸€ä¸ªæ•°ç»„ |

**å…¨å±€tmpçš„å…³é”®ï¼š**
```cpp
vector<int> tmp;
tmp.resize(nums.size());  // åªåˆ†é…ä¸€æ¬¡

// tmpçš„ç´¢å¼•ä»leftå¼€å§‹ï¼Œä¸æ˜¯ä»0
int k = left;
tmp[k++] = nums[cur1++];

// æ‹·è´æ—¶ç´¢å¼•å¯¹åº”
nums[i] = tmp[i];  // ä¸æ˜¯ nums[i] = tmp[i-left]
```

#### 6. resize è¯¦è§£

**`resize(n)` çš„ä½œç”¨ï¼š**
- æŠŠ `vector` çš„å¤§å°è°ƒæ•´ä¸º n
- åˆ†é…å¥½å†…å­˜ç©ºé—´
- æ‰€æœ‰å…ƒç´ åˆå§‹åŒ–ä¸º 0
- å¯ä»¥ç›´æ¥ç”¨ä¸‹æ ‡è®¿é—®

**å¯¹æ¯”ï¼š**
```cpp
// resizeï¼šåˆ†é…ç©ºé—´å¹¶åˆ›å»ºå…ƒç´ 
vector<int> v;
v.resize(5);   // v = [0, 0, 0, 0, 0], size=5
v[2] = 10;     // âœ… OK

// reserveï¼šåªé¢„ç•™ç©ºé—´ï¼Œä¸åˆ›å»ºå…ƒç´ 
vector<int> v;
v.reserve(5);  // size=0, capacity=5
v[2] = 10;     // âŒ è¶Šç•Œï¼

// push_backï¼šåŠ¨æ€æ·»åŠ 
vector<int> v;
v.push_back(10);  // âœ… OK, v = [10]
```

**åœ¨å½’å¹¶æ’åºä¸­ä¸ºä»€ä¹ˆç”¨ `resize`ï¼Ÿ**
- å› ä¸ºåé¢è¦ç”¨ä¸‹æ ‡è®¿é—®ï¼š`tmp[k++] = nums[cur1++]`
- å¦‚æœç”¨ `reserve`ï¼Œsizeè¿˜æ˜¯0ï¼Œä¸‹æ ‡è®¿é—®ä¼šè¶Šç•Œ

#### 7. å®Œæ•´æ‰§è¡Œè¿‡ç¨‹å›¾è§£

**ç¤ºä¾‹æ•°ç»„ï¼š[3, 1, 2, 4]**

**é€’å½’åˆ†è§£è¿‡ç¨‹ï¼š**
```
         [3, 1, 2, 4]
         /          \
     [3, 1]        [2, 4]
     /   \         /   \
   [3]   [1]     [2]   [4]
   å•ä¸ªå…ƒç´ ï¼Œå·²æœ‰åº
```

**é€’å½’åˆå¹¶è¿‡ç¨‹ï¼ˆä»ä¸‹å¾€ä¸Šï¼‰ï¼š**

##### ğŸ”µ ç¬¬1æ¬¡åˆå¹¶ï¼š[3] å’Œ [1]

```
nums = [3, 1, 2, 4]
        â†‘  â†‘
      left=0, mid=0, right=1

å½“å‰è¦åˆå¹¶ï¼šnums[0...0] å’Œ nums[1...1] â†’ [3] å’Œ [1]

--- å¼€å§‹åˆå¹¶ ---
cur1 = 0, cur2 = 1, k = 0  // kä»leftå¼€å§‹

while(cur1 <= 0 && cur2 <= 1):
  nums[0]=3, nums[1]=1
  1 < 3 â†’ tmp[0] = 1, cur2++
  
while(cur1 <= 0):  // å¤„ç†å·¦è¾¹å‰©ä½™
  tmp[1] = 3, cur1++

tmp = [1, 3, ?, ?]

--- æ‹·è´å›åŸæ•°ç»„ ---
for(i = 0; i <= 1; i++)
  nums[0] = tmp[0] = 1
  nums[1] = tmp[1] = 3

ç»“æœï¼šnums = [1, 3, 2, 4]
           â†‘  â†‘ å·²æ’åº
```

##### ğŸ”µ ç¬¬2æ¬¡åˆå¹¶ï¼š[2] å’Œ [4]

```
nums = [1, 3, 2, 4]
              â†‘  â†‘
            left=2, mid=2, right=3

å½“å‰è¦åˆå¹¶ï¼šnums[2...2] å’Œ nums[3...3] â†’ [2] å’Œ [4]

--- å¼€å§‹åˆå¹¶ ---
cur1 = 2, cur2 = 3, k = 2  // æ³¨æ„ï¼škä»2å¼€å§‹ï¼

while(cur1 <= 2 && cur2 <= 3):
  nums[2]=2, nums[3]=4
  2 < 4 â†’ tmp[2] = 2, cur1++
  
while(cur2 <= 3):  // å¤„ç†å³è¾¹å‰©ä½™
  tmp[3] = 4, cur2++

tmp = [1, 3, 2, 4]

--- æ‹·è´å›åŸæ•°ç»„ ---
for(i = 2; i <= 3; i++)
  nums[2] = tmp[2] = 2
  nums[3] = tmp[3] = 4

ç»“æœï¼šnums = [1, 3, 2, 4]
                 â†‘  â†‘ å·²æ’åº
```

##### ğŸ”µ ç¬¬3æ¬¡åˆå¹¶ï¼š[1,3] å’Œ [2,4]ï¼ˆæœ€ç»ˆåˆå¹¶ï¼‰

```
nums = [1, 3, 2, 4]
        â†‘     â†‘   â†‘
      left=0, mid=1, right=3

å½“å‰è¦åˆå¹¶ï¼šnums[0...1] å’Œ nums[2...3] â†’ [1,3] å’Œ [2,4]

--- å¼€å§‹åˆå¹¶ ---
cur1 = 0, cur2 = 2, k = 0

while(cur1 <= 1 && cur2 <= 3):
  ç¬¬1è½®ï¼šnums[0]=1, nums[2]=2
        1 < 2 â†’ tmp[0] = 1, cur1++
        
  ç¬¬2è½®ï¼šnums[1]=3, nums[2]=2
        2 < 3 â†’ tmp[1] = 2, cur2++
        
  ç¬¬3è½®ï¼šnums[1]=3, nums[3]=4
        3 < 4 â†’ tmp[2] = 3, cur1++

while(cur2 <= 3):  // å¤„ç†å³è¾¹å‰©ä½™
  tmp[3] = 4, cur2++

tmp = [1, 2, 3, 4]

--- æ‹·è´å›åŸæ•°ç»„ ---
for(i = 0; i <= 3; i++)
  nums[0] = tmp[0] = 1
  nums[1] = tmp[1] = 2
  nums[2] = tmp[2] = 3
  nums[3] = tmp[3] = 4

æœ€ç»ˆç»“æœï¼šnums = [1, 2, 3, 4] âœ…
```

**å®Œæ•´æµç¨‹å›¾ï¼š**
```
åŸæ•°ç»„: [3, 1, 2, 4]

åˆ†è§£ï¼š
         [3, 1, 2, 4]
         /          \
     [3, 1]        [2, 4]
     /   \         /   \
   [3]   [1]     [2]   [4]

åˆå¹¶ï¼ˆä»ä¸‹å¾€ä¸Šï¼‰ï¼š
   [3]   [1]     [2]   [4]
     \   /         \   /
   [1, 3]         [2, 4]   â† æ¯æ¬¡åˆå¹¶éƒ½æ‹·è´å›nums
       \          /
       [1, 2, 3, 4]        â† æœ€ç»ˆç»“æœ

æ¯æ¬¡åˆå¹¶ånumsçš„çŠ¶æ€å˜åŒ–ï¼š
åˆå§‹          â†’ [3, 1, 2, 4]
åˆå¹¶[3][1]    â†’ [1, 3, 2, 4]
åˆå¹¶[2][4]    â†’ [1, 3, 2, 4]
åˆå¹¶[1,3][2,4] â†’ [1, 2, 3, 4]
```

**å…³é”®ç†è§£ç‚¹ï¼š**

1. **k ä¸ºä»€ä¹ˆä» left å¼€å§‹ï¼Ÿ**
   - tmpæ˜¯å…¨å±€æ•°ç»„ï¼Œæ¯æ¬¡é€’å½’åªç”¨ `[left, right]` è¿™éƒ¨åˆ†
   - ç¬¬1æ¬¡åˆå¹¶ç”¨ `tmp[0], tmp[1]`
   - ç¬¬2æ¬¡åˆå¹¶ç”¨ `tmp[2], tmp[3]`
   - ç¬¬3æ¬¡åˆå¹¶ç”¨ `tmp[0], tmp[1], tmp[2], tmp[3]`

2. **ä¸ºä»€ä¹ˆæ‹·è´æ—¶ç”¨ `nums[i] = tmp[i]`ï¼Ÿ**
   - å› ä¸ºkä»leftå¼€å§‹ï¼Œtmpçš„ç´¢å¼•å’Œnumsçš„ç´¢å¼•æ˜¯å¯¹åº”çš„
   - `tmp[0]` å¯¹åº” `nums[0]`ï¼Œ`tmp[1]` å¯¹åº” `nums[1]`...

3. **æ¯æ¬¡åˆå¹¶éƒ½è¦æ‹·è´å—ï¼Ÿ**
   - æ˜¯çš„ï¼æ¯æ¬¡åˆå¹¶å®Œéƒ½è¦æ‹·è´å›åŸæ•°ç»„
   - å› ä¸ºä¸Šå±‚é€’å½’éœ€è¦çœ‹åˆ°å·²æ’åºçš„ç»“æœ
   - ä¾‹å¦‚ï¼šåˆå¹¶ `[3]` å’Œ `[1]` åï¼Œ`nums[0]=1, nums[1]=3`ï¼Œä¸Šå±‚æ‰èƒ½æ­£ç¡®åˆå¹¶ `[1,3]` å’Œ `[2,4]`

### å¤æ‚åº¦åˆ†æ

**æ—¶é—´å¤æ‚åº¦ï¼š** O(n log n)
- é€’å½’æ·±åº¦ï¼šO(log n)
- æ¯å±‚åˆå¹¶ï¼šO(n)
- æ€»æ—¶é—´ï¼šO(n log n)

**ç©ºé—´å¤æ‚åº¦ï¼š** O(n)
- ä¸´æ—¶æ•°ç»„ï¼šO(n)
- é€’å½’æ ˆï¼šO(log n)
- æ€»ç©ºé—´ï¼šO(n)

**å½’å¹¶æ’åº vs å¿«é€Ÿæ’åºï¼š**

| ç®—æ³• | å¹³å‡æ—¶é—´ | æœ€åæ—¶é—´ | ç©ºé—´ | ç¨³å®šæ€§ |
|------|---------|---------|------|--------|
| å½’å¹¶æ’åº | O(n log n) | O(n log n) | O(n) | âœ… ç¨³å®š |
| å¿«é€Ÿæ’åº | O(n log n) | O(nÂ²) | O(log n) | âŒ ä¸ç¨³å®š |

**å½’å¹¶æ’åºçš„ä¼˜åŠ¿ï¼š**
- æ—¶é—´å¤æ‚åº¦ç¨³å®šï¼Œæœ€åæƒ…å†µä¹Ÿæ˜¯ O(n log n)
- æ˜¯ç¨³å®šæ’åº
- é€‚åˆå¤–éƒ¨æ’åºï¼ˆå¤„ç†å¤§æ–‡ä»¶ï¼‰

**å½’å¹¶æ’åºçš„åŠ£åŠ¿ï¼š**
- éœ€è¦é¢å¤–çš„ O(n) ç©ºé—´
- å¸¸æ•°å› å­è¾ƒå¤§ï¼Œå®é™…è¿è¡Œå¯èƒ½æ…¢äºå¿«æ’

---

## 2. æ•°ç»„ä¸­çš„é€†åºå¯¹ - å‰‘æŒ‡Offer 51

**é¢˜ç›®é“¾æ¥ï¼š** https://leetcode.cn/problems/shu-zu-zhong-de-ni-xu-dui-lcof/

### é¢˜ç›®æè¿°

åœ¨è‚¡ç¥¨äº¤æ˜“ä¸­ï¼Œå¦‚æœå‰ä¸€å¤©çš„è‚¡ä»·é«˜äºåä¸€å¤©çš„è‚¡ä»·ï¼Œåˆ™å¯ä»¥è®¤ä¸ºå­˜åœ¨ä¸€ä¸ªã€Œäº¤æ˜“é€†åºå¯¹ã€ã€‚è¯·è®¾è®¡ä¸€ä¸ªç¨‹åºï¼Œè¾“å…¥ä¸€æ®µæ—¶é—´å†…çš„è‚¡ç¥¨äº¤æ˜“è®°å½• recordï¼Œè¿”å›å…¶ä¸­å­˜åœ¨çš„ã€Œäº¤æ˜“é€†åºå¯¹ã€æ€»æ•°ã€‚

**ç¤ºä¾‹1ï¼š**
```
è¾“å…¥ï¼šrecord = [9, 7, 5, 4, 6]
è¾“å‡ºï¼š8
è§£é‡Šï¼šäº¤æ˜“ä¸­çš„é€†åºå¯¹ä¸º (9, 7), (9, 5), (9, 4), (9, 6), (7, 5), (7, 4), (7, 6), (5, 4)
```

**æç¤ºï¼š**
- `0 <= record.length <= 50000`

### è§£é¢˜æ€è·¯

#### ğŸ¤” é—®é¢˜1ï¼šä»€ä¹ˆæ˜¯é€†åºå¯¹ï¼Ÿ

**å®šä¹‰ï¼š** å¦‚æœ `i < j` ä¸” `record[i] > record[j]`ï¼Œåˆ™ `(record[i], record[j])` æ˜¯ä¸€ä¸ªé€†åºå¯¹ã€‚

**æ‰‹åŠ¨æ‰¾é€†åºå¯¹ï¼š**
```
record = [9, 7, 5, 4, 6]
         â†‘
9 å’Œåé¢æ‰€æœ‰æ¯”å®ƒå°çš„ï¼š(9,7), (9,5), (9,4), (9,6) â†’ 4ä¸ª

record = [9, 7, 5, 4, 6]
            â†‘
7 å’Œåé¢æ‰€æœ‰æ¯”å®ƒå°çš„ï¼š(7,5), (7,4), (7,6) â†’ 3ä¸ª

record = [9, 7, 5, 4, 6]
               â†‘
5 å’Œåé¢æ‰€æœ‰æ¯”å®ƒå°çš„ï¼š(5,4) â†’ 1ä¸ª

record = [9, 7, 5, 4, 6]
                  â†‘
4 å’Œåé¢æ‰€æœ‰æ¯”å®ƒå°çš„ï¼šæ—  â†’ 0ä¸ª

record = [9, 7, 5, 4, 6]
                     â†‘
6 åé¢æ²¡æœ‰å…ƒç´  â†’ 0ä¸ª

æ€»å…±ï¼š4 + 3 + 1 + 0 + 0 = 8 âœ…
```

#### ğŸ¤” é—®é¢˜2ï¼šæš´åŠ›è§£æ³•ä¸ºä»€ä¹ˆè¶…æ—¶ï¼Ÿ

**æš´åŠ›ä»£ç ï¼š**
```cpp
int count = 0;
for(int i = 0; i < n; i++) {
    for(int j = i + 1; j < n; j++) {
        if(nums[i] > nums[j]) {
            count++;  // æ‰¾åˆ°ä¸€ä¸ªé€†åºå¯¹
        }
    }
}
```

**æ—¶é—´å¤æ‚åº¦ï¼š** O(nÂ²)

**ç¤ºä¾‹ï¼š** `n = 50000`ï¼ˆé¢˜ç›®æœ€å¤§æ•°æ®ï¼‰
- éœ€è¦æ¯”è¾ƒï¼š50000 Ã— 50000 / 2 = 1,250,000,000 æ¬¡ï¼ˆ**12.5äº¿æ¬¡**ï¼‰
- å¦‚æœæ¯æ¬¡æ¯”è¾ƒéœ€è¦ 2nsï¼Œæ€»å…±éœ€è¦ï¼š2.5ç§’
- LeetCode æ—¶é—´é™åˆ¶é€šå¸¸æ˜¯ 1-2 ç§’ â†’ **è¶…æ—¶ï¼** âŒ

#### ğŸ¤” é—®é¢˜3ï¼šå¦‚ä½•æƒ³åˆ°å½’å¹¶æ’åºï¼Ÿ

**æ€ç»´é“¾æ¡ï¼š**

1ï¸âƒ£ **æš´åŠ› O(nÂ²) è¶…æ—¶ â†’ éœ€è¦ä¼˜åŒ–**

2ï¸âƒ£ **èƒ½å¦åˆ©ç”¨æŸç§æ€§è´¨åŠ é€Ÿï¼Ÿ**
```
å¦‚æœæ•°ç»„æœ‰åºï¼Œç»Ÿè®¡ä¼šå¾ˆç®€å•å—ï¼Ÿ

æœ‰åºæ•°ç»„ï¼š[1, 2, 3, 4, 5]
é€†åºå¯¹ï¼š0ä¸ª

é€†åºæ•°ç»„ï¼š[5, 4, 3, 2, 1]
é€†åºå¯¹ï¼š4+3+2+1 = 10ä¸ª

å—¯ï¼Œæœ‰åºæ€§èƒ½å¸®åŠ©ç»Ÿè®¡ï¼ä½†æ’åºåä¿¡æ¯ä¸å°±ä¸¢äº†ï¼Ÿ
```

3ï¸âƒ£ **åœ¨æ’åºä¸­ç»Ÿè®¡ â†’ å“ªç§æ’åºèƒ½åˆ©ç”¨æœ‰åºæ€§ï¼Ÿ**
```
å†’æ³¡æ’åºï¼Ÿæ¯æ¬¡äº¤æ¢å°±æ˜¯ä¸€ä¸ªé€†åºå¯¹ï¼Ÿ
â†’ è¿˜æ˜¯O(nÂ²)ï¼Œæ²¡ç”¨

å¿«é€Ÿæ’åºï¼Ÿåˆ†æ²»æ€æƒ³ï¼Ÿ
â†’ æ¯æ¬¡åˆ†åŒºæ²¡æ³•æ‰¹é‡ç»Ÿè®¡

å½’å¹¶æ’åºï¼Ÿåˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„æ—¶...
â†’ æœ‰åºæ€§ + æ‰¹é‡ç»Ÿè®¡ï¼ğŸ¯
```

4ï¸âƒ£ **å½’å¹¶æ’åºçš„å…³é”®æ´å¯Ÿ**

```
åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„æ—¶ï¼š
å·¦è¾¹ï¼š[7, 9]ï¼ˆå·²æ’åºï¼‰
å³è¾¹ï¼š[4, 5, 6]ï¼ˆå·²æ’åºï¼‰

å½“æ¯”è¾ƒ 7 å’Œ 4ï¼š
7 > 4 â†’ å‘ç°é€†åºå¯¹ (7, 4)

å…³é”®ï¼šå› ä¸ºå·¦è¾¹æœ‰åºï¼Œ9 > 7 > 4
æ‰€ä»¥ 9 å’Œ 4 ä¹Ÿæ„æˆé€†åºå¯¹ï¼

æ‰¹é‡ç»Ÿè®¡ï¼šä»7åˆ°9çš„æ‰€æœ‰å…ƒç´ ï¼ˆmid - cur1 + 1 ä¸ªï¼‰
éƒ½èƒ½å’Œ4æ„æˆé€†åºå¯¹ï¼
```

**æ ¸å¿ƒï¼š** å½’å¹¶æ’åºåœ¨åˆå¹¶æ—¶ï¼Œå¯ä»¥**åˆ©ç”¨æœ‰åºæ€§æ‰¹é‡ç»Ÿè®¡é€†åºå¯¹**ï¼Œé¿å…ä¸€ä¸ªä¸€ä¸ªæ¯”è¾ƒï¼

---

#### ğŸ¤” é—®é¢˜4ï¼šä¸ºä»€ä¹ˆæ’åºäº†è¿˜èƒ½ç»Ÿè®¡æ­£ç¡®ï¼Ÿ

**å…³é”®ç†è§£ï¼š** æˆ‘ä»¬æ˜¯**å…ˆç»Ÿè®¡ï¼Œå†æ’åº**ï¼

**å®Œæ•´ä¾‹å­è¿½è¸ªï¼š**

```
åŸæ•°ç»„ï¼š[7, 9, 4, 5, 6]

é€†åºå¯¹åˆ†å¸ƒåœ¨ä¸‰ä¸ªä½ç½®ï¼š
1ï¸âƒ£ å·¦åŠéƒ¨åˆ†å†…éƒ¨ï¼š[7, 9] å†…éƒ¨ â†’ 0ä¸ª
2ï¸âƒ£ å³åŠéƒ¨åˆ†å†…éƒ¨ï¼š[4, 5, 6] å†…éƒ¨ â†’ 0ä¸ª
3ï¸âƒ£ è·¨è¶Šå·¦å³ï¼š(7,4), (7,5), (7,6), (9,4), (9,5), (9,6) â†’ 6ä¸ª

é€’å½’å¤„ç†ï¼š
- mergeSort(å·¦) â†’ è¿”å›å·¦åŠéƒ¨åˆ†å†…éƒ¨çš„é€†åºå¯¹æ•°
- mergeSort(å³) â†’ è¿”å›å³åŠéƒ¨åˆ†å†…éƒ¨çš„é€†åºå¯¹æ•°
- åˆå¹¶æ—¶ â†’ ç»Ÿè®¡è·¨åŒºé—´çš„é€†åºå¯¹æ•°

æ€»æ•° = å·¦ + å³ + è·¨åŒºé—´
```

**åˆå¹¶è¿‡ç¨‹è¯¦è§£ï¼š**

```
å·¦ï¼š[7, 9]  ä½ç½®ï¼šleft=0, mid=1
å³ï¼š[4, 5, 6]  ä½ç½®ï¼šmid+1=2, right=4

åˆå§‹ï¼šcount = 0, cur1 = 0, cur2 = 2

æ­¥éª¤1ï¼š
  nums[0]=7, nums[2]=4
  7 > 4 â†’ å–4ï¼Œcount += (1 - 0 + 1) = 2
  ï¼ˆå‘ç°é€†åºå¯¹ï¼š(7,4), (9,4)ï¼‰
  
æ­¥éª¤2ï¼š
  nums[0]=7, nums[3]=5
  7 > 5 â†’ å–5ï¼Œcount += (1 - 0 + 1) = 2
  ï¼ˆå‘ç°é€†åºå¯¹ï¼š(7,5), (9,5)ï¼‰
  count = 4

æ­¥éª¤3ï¼š
  nums[0]=7, nums[4]=6
  7 > 6 â†’ å–6ï¼Œcount += (1 - 0 + 1) = 2
  ï¼ˆå‘ç°é€†åºå¯¹ï¼š(7,6), (9,6)ï¼‰
  count = 6

æ­¥éª¤4ï¼š
  cur2 > rightï¼Œå³è¾¹éå†å®Œ
  å–å·¦è¾¹å‰©ä½™ï¼š7, 9

åˆå¹¶åï¼š[4, 5, 6, 7, 9]ï¼ˆå·²æ’åºï¼‰
è¿”å›ï¼šcount = 6 âœ…
```

**å…³é”®æœºåˆ¶ï¼š**
- æ¯æ¬¡æ¯”è¾ƒæ—¶ï¼Œ**å‘ç°é€†åºå¯¹å°±ç«‹å³ç»Ÿè®¡**
- ç»Ÿè®¡å®Œåæ‰æ’åºï¼ˆæŠŠå…ƒç´ æ”¾åˆ°æ­£ç¡®ä½ç½®ï¼‰
- count å˜é‡å·²ç»ä¿å­˜äº†é€†åºå¯¹ä¿¡æ¯
- æ’åºåªæ˜¯"æ¶ˆç­"é€†åºå¯¹ï¼Œä½†æˆ‘ä»¬å·²ç»è®°å½•è¿‡äº†

---

#### ğŸ¤” é—®é¢˜5ï¼šä¸ºä»€ä¹ˆè¦é€’å½’ï¼Ÿ

**é€†åºå¯¹çš„ä¸‰ç§æƒ…å†µï¼š**

```
[left ... mid ... right]
 â””â”€å·¦åŠéƒ¨åˆ†â”€â”˜ â””â”€å³åŠéƒ¨åˆ†â”€â”˜

1ï¸âƒ£ å·¦åŠéƒ¨åˆ†å†…éƒ¨çš„é€†åºå¯¹
   ä¾‹å¦‚ï¼š[7, 9, 4] ä¸­ï¼Œ(7,4), (9,4) â† éƒ½åœ¨å·¦è¾¹

2ï¸âƒ£ å³åŠéƒ¨åˆ†å†…éƒ¨çš„é€†åºå¯¹
   ä¾‹å¦‚ï¼š[5, 4] ä¸­ï¼Œ(5,4) â† éƒ½åœ¨å³è¾¹

3ï¸âƒ£ è·¨è¶Šå·¦å³çš„é€†åºå¯¹
   ä¾‹å¦‚ï¼šå·¦è¾¹çš„7 å’Œ å³è¾¹çš„5 â†’ (7,5)
```

**é€’å½’çš„ä½œç”¨ï¼š**
```cpp
int count = mergeSort(nums, left, mid)      // å¤„ç†æƒ…å†µ1ï¸âƒ£
          + mergeSort(nums, mid + 1, right) // å¤„ç†æƒ…å†µ2ï¸âƒ£
          + åˆå¹¶æ—¶ç»Ÿè®¡;                      // å¤„ç†æƒ…å†µ3ï¸âƒ£
```

**ä¸é€’å½’è¡Œå—ï¼Ÿ**
```
å¦‚æœä¸é€’å½’ï¼Œåªåœ¨æœ€å¤–å±‚åˆå¹¶ï¼š
[7, 9, 4, 5, 6]
 â†‘  â†‘
æ— åºï¼æ— æ³•åˆ©ç”¨"æœ‰åºæ€§"æ‰¹é‡ç»Ÿè®¡ï¼

é€’å½’çš„ç›®çš„ï¼š
è®©å·¦å³ä¸¤è¾¹å„è‡ªæœ‰åº â†’ æ‰èƒ½åœ¨åˆå¹¶æ—¶æ‰¹é‡ç»Ÿè®¡è·¨åŒºé—´é€†åºå¯¹
```

---

### æˆ‘çš„ä»£ç 

#### åˆå§‹é”™è¯¯ç‰ˆæœ¬

```cpp
class Solution {
public:
    vector<int> tmp = vector<int>(50010, 0);
    
    int reversePairs(vector<int>& nums) {
        return mergeSort(nums, 0, nums.size() - 1); 
    }
    
    int mergeSort(vector<int>& nums, int left, int right)
    {
        if(left >= right) return 0;
        
        int mid = (left + right) >> 1;
        int count = 0;
        
        count += mergeSort(nums, left, mid)
                + mergeSort(nums, mid + 1, right);
        
        int cur1 = left, cur2 = right;  // âŒ é”™è¯¯ï¼šcur2åº”è¯¥æ˜¯ mid+1
        int k = left;
        
        while(cur1 <= mid && cur2 <= right)
        {
            if(nums[cur1] <= nums[cur2])
            {
                tmp[k++] = nums[cur1++];
            }
            else 
            {
                tmp[k++] = nums[cur2++];
                count += mid - cur1 + 1;
            }
        }
        
        while(cur1 <= mid) tmp[k++] = nums[cur1++];
        while(cur2 <= right) tmp[k++] = nums[cur2++];
        
        for(int i = left; i <= right; i++)
        {
            nums[i] = tmp[i];
        }
        
        return count;  // âŒ åˆå§‹ç‰ˆæœ¬è¿˜å¿˜äº†è¿™ä¸€è¡Œ
    }
};
```

**é”™è¯¯åˆ†æï¼š**

1. **`cur2 = right` é”™è¯¯ï¼š**
   ```
   å·¦è¾¹åŒºé—´ï¼š[left, mid]      â†’ cur1 ä» left å¼€å§‹ âœ…
   å³è¾¹åŒºé—´ï¼š[mid+1, right]   â†’ cur2 ä» mid+1 å¼€å§‹ âœ…
   
   å†™æˆ cur2 = right ä¼šè·³è¿‡ä¸­é—´å…ƒç´ ï¼
   
   ä¾‹å¦‚ï¼šleft=0, mid=0, right=2
   å·¦è¾¹ï¼š[7]  ä½ç½® [0]
   å³è¾¹ï¼š[5,6] ä½ç½® [1,2]
   
   cur2 = right = 2 â†’ ç›´æ¥æŒ‡å‘6ï¼Œè·³è¿‡äº†5ï¼âŒ
   cur2 = mid+1 = 1 â†’ æ­£ç¡®æŒ‡å‘5 âœ…
   ```

2. **ç¼ºå°‘ `return count;`**
   - `mergeSort` è¿”å›ç±»å‹æ˜¯ `int`ï¼Œå¿…é¡»è¿”å›å€¼
   - å¦åˆ™ç¼–è¯‘é”™è¯¯ï¼š"non-void function does not return a value"

**æµ‹è¯•ç”¨ä¾‹å¤±è´¥ï¼š**
```
è¾“å…¥ï¼šrecord = [7, 5, 6, 4]
è¾“å‡ºï¼š3
é¢„æœŸï¼š5

æ­£ç¡®çš„é€†åºå¯¹ï¼š(7,5), (7,6), (7,4), (5,4), (6,4) = 5ä¸ª
è·³è¿‡å…ƒç´ å¯¼è‡´æ¼ç»Ÿè®¡ï¼
```

---

#### ACä»£ç  â­

```cpp
class Solution {
public:
    vector<int> tmp = vector<int>(50010, 0);
    
    int reversePairs(vector<int>& nums) {
        // åˆ†æ²»ï¼Œå½’å¹¶æ’åºï¼Œæš´åŠ›æ˜¯nÂ²çº§åˆ«è¶…æ—¶ï¼Œæœ‰åºæ—¶é€†åºå¯¹å¯ä¼˜åŒ–åŠ é€Ÿç»Ÿè®¡
        /*é‡åˆ°é€†åºå¯¹é—®é¢˜ï¼Œå¦‚ä½•æƒ³åˆ°å½’å¹¶æ’åºï¼Ÿ
        æš´åŠ›è§£æ³• O(nÂ²) â†’ æ•°æ®é‡å¤§ä¼šè¶…æ—¶
        éœ€è¦ä¼˜åŒ– â†’ èƒ½å¦åˆ©ç”¨æŸç§æ€§è´¨åŠ é€Ÿï¼Ÿ
        æœ‰åºæ€§ â†’ å¦‚æœæ•°ç»„æœ‰åºï¼Œç»Ÿè®¡ä¼šå¾ˆç®€å•
        åœ¨æ’åºä¸­ç»Ÿè®¡ â†’ å“ªç§æ’åºèƒ½åˆ©ç”¨æœ‰åºæ€§ï¼Ÿ
        å½’å¹¶æ’åº â†’ åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„æ—¶ï¼Œæ‰¹é‡ç»Ÿè®¡ï¼
        
        å½’å¹¶æ’åºç»Ÿè®¡é€†åºå¯¹çš„æ ¸å¿ƒï¼š
        å½“ nums[cur1] > nums[cur2] æ—¶ï¼Œ
        å·¦è¾¹ä» cur1 åˆ° mid çš„æ‰€æœ‰å…ƒç´ éƒ½å¤§äº nums[cur2]ï¼Œ
        ä¸€æ¬¡æ€§äº§ç”Ÿ (mid - cur1 + 1) ä¸ªé€†åºå¯¹ï¼
        */
        return mergeSort(nums, 0, nums.size() - 1); 
    }
    
    int mergeSort(vector<int>& nums, int left, int right)
    {
        if(left >= right) return 0;
        
        int mid = (left + right) >> 1;
        int count = 0;  // è®°å½•é€†åºå¯¹æ•°é‡
        
        // [left, mid], [mid + 1, right]
        // åˆ†ï¼šç»Ÿè®¡å·¦åŠéƒ¨åˆ†å’Œå³åŠéƒ¨åˆ†å†…éƒ¨çš„é€†åºå¯¹
        count += mergeSort(nums, left, mid)
                + mergeSort(nums, mid + 1, right);
        
        // åˆå¹¶ï¼šç»Ÿè®¡è·¨è¶Šä¸¤åŒºé—´çš„é€†åºå¯¹ï¼Œæ‰¹é‡ç»Ÿè®¡ï¼Œä¼˜åŒ–æ ¸å¿ƒ
        int cur1 = left, cur2 = mid + 1;  // âœ… cur2 ä» mid+1 å¼€å§‹
        int k = left;  // tmpçš„ç´¢å¼•ä¹Ÿä»leftå¼€å§‹
        
        while(cur1 <= mid && cur2 <= right)
        {
            if(nums[cur1] <= nums[cur2])
            {
                tmp[k++] = nums[cur1++];
            }
            else 
            {
                // å‘ç°é€†åºå¯¹ï¼æ‰¹é‡ç»Ÿè®¡
                tmp[k++] = nums[cur2++];
                count += mid - cur1 + 1;  // ğŸ¯ å…³é”®ï¼šæ‰¹é‡ç»Ÿè®¡
            }
        }
        
        // å¤„ç†å‰©ä½™å…ƒç´ 
        while(cur1 <= mid) tmp[k++] = nums[cur1++];
        while(cur2 <= right) tmp[k++] = nums[cur2++];
        
        // æ‹·è´å›åŸæ•°ç»„
        for(int i = left; i <= right; i++)
        {
            nums[i] = tmp[i];
        }
        
        return count;  // âœ… è¿”å›é€†åºå¯¹æ€»æ•°
    }
};
```

**æ—¶é—´ï¼š** çº¦ 300msï¼ˆå…·ä½“å–å†³äºæµ‹è¯•æ•°æ®ï¼‰  
**å‡»è´¥ï¼š** çº¦ 70% ç”¨æˆ·

---

### æ ¸å¿ƒç†è§£

#### 1. é€†åºå¯¹ç»Ÿè®¡å…¬å¼

```cpp
when nums[cur1] > nums[cur2]:
    count += (mid - cur1 + 1)
```

**æ¨å¯¼è¿‡ç¨‹ï¼š**

```
å·¦è¾¹ï¼ˆæœ‰åºï¼‰ï¼š[7, 9]
              â†‘  â†‘
            cur1=0, mid=1
            
å³è¾¹ï¼ˆæœ‰åºï¼‰ï¼š[4, 5, 6]
              â†‘
            cur2=2

æ¯”è¾ƒï¼šnums[0]=7, nums[2]=4
     7 > 4 â†’ å‘ç°é€†åºå¯¹ï¼

é—®é¢˜1ï¼šåªæœ‰ (7,4) è¿™ä¸€ä¸ªé€†åºå¯¹å—ï¼Ÿ
ç­”ï¼šä¸ï¼å› ä¸ºå·¦è¾¹æœ‰åºï¼Œ9 > 7 > 4
   æ‰€ä»¥ (9,4) ä¹Ÿæ˜¯é€†åºå¯¹ï¼

é—®é¢˜2ï¼šä»ä¸‹æ ‡0åˆ°ä¸‹æ ‡1ï¼Œæœ‰å¤šå°‘ä¸ªå…ƒç´ ï¼Ÿ
ç­”ï¼šmid - cur1 + 1 = 1 - 0 + 1 = 2

æ‰€ä»¥ï¼šä¸€æ¬¡æ€§äº§ç”Ÿ 2 ä¸ªé€†åºå¯¹ï¼
```

**ä¸ºä»€ä¹ˆè¿™æ ·ç»Ÿè®¡æ˜¯å¯¹çš„ï¼Ÿ**

```
å·¦è¾¹æœ‰åºçš„æ€§è´¨ï¼š
nums[cur1] < nums[cur1+1] < ... < nums[mid]

å½“ nums[cur1] > nums[cur2] æ—¶ï¼š
â†’ nums[cur1+1] > nums[cur1] > nums[cur2]
â†’ nums[cur1+2] > nums[cur1] > nums[cur2]
â†’ ...
â†’ nums[mid] > nums[cur1] > nums[cur2]

æ‰€ä»¥ä» cur1 åˆ° mid çš„æ‰€æœ‰å…ƒç´ éƒ½å¤§äº nums[cur2]
éƒ½èƒ½å’Œ nums[cur2] æ„æˆé€†åºå¯¹ï¼

æ‰¹é‡ç»Ÿè®¡ï¼šmid - cur1 + 1 ä¸ªé€†åºå¯¹
```

#### 2. åªåœ¨ else åˆ†æ”¯ç»Ÿè®¡

```cpp
if(nums[cur1] <= nums[cur2]) {
    // å·¦è¾¹å°ï¼Œä¸äº§ç”Ÿé€†åºå¯¹ âŒ
    tmp[k++] = nums[cur1++];
} else {
    // å·¦è¾¹å¤§ï¼Œäº§ç”Ÿé€†åºå¯¹ï¼âœ…
    tmp[k++] = nums[cur2++];
    count += mid - cur1 + 1;  // ç»Ÿè®¡
}
```

**ä¸ºä»€ä¹ˆåªåœ¨ else ç»Ÿè®¡ï¼Ÿ**

| æƒ…å†µ | æ˜¯å¦é€†åºå¯¹ | æ“ä½œ |
|------|-----------|------|
| å·¦ â‰¤ å³ | âŒ ä¸æ˜¯ | å–å·¦è¾¹ï¼Œä¸ç»Ÿè®¡ |
| å·¦ > å³ | âœ… æ˜¯ï¼ | å–å³è¾¹ï¼Œ**æ‰¹é‡ç»Ÿè®¡** |

#### 3. å½’å¹¶æ’åº vs æš´åŠ›è§£æ³•

| æ–¹æ³• | æ—¶é—´å¤æ‚åº¦ | æ ¸å¿ƒæ€æƒ³ |
|------|-----------|---------|
| æš´åŠ› | O(nÂ²) | åŒé‡å¾ªç¯ï¼Œä¸€ä¸ªä¸€ä¸ªæ¯”è¾ƒ |
| å½’å¹¶ | O(n log n) | åˆ©ç”¨æœ‰åºæ€§ï¼Œæ‰¹é‡ç»Ÿè®¡ |

**ä¼˜åŒ–å…³é”®ï¼š**
```
æš´åŠ›ï¼šæ¯æ¬¡åªèƒ½ç»Ÿè®¡ 1 ä¸ªé€†åºå¯¹
å½’å¹¶ï¼šæ¯æ¬¡å¯ä»¥ç»Ÿè®¡ (mid - cur1 + 1) ä¸ªé€†åºå¯¹

ä¾‹å¦‚ï¼š
å·¦è¾¹æœ‰ 1000 ä¸ªå…ƒç´ ï¼Œcur1=0
å½“å‘ç° nums[0] > nums[cur2] æ—¶
æš´åŠ›éœ€è¦æ¯”è¾ƒ 1000 æ¬¡
å½’å¹¶åªéœ€è¦åŠ ä¸€æ¬¡ï¼šcount += 1000
```

#### 4. æ­£ç¡®æ€§ä¿è¯ï¼šåˆ†å±‚ç»Ÿè®¡

```
é€†åºå¯¹æ€»æ•° = å·¦åŠéƒ¨åˆ†å†…éƒ¨ + å³åŠéƒ¨åˆ†å†…éƒ¨ + è·¨åŒºé—´

ä»£ç ä½“ç°ï¼š
int count = mergeSort(å·¦)      // å·¦å†…éƒ¨
          + mergeSort(å³)      // å³å†…éƒ¨
          + åˆå¹¶æ—¶ç»Ÿè®¡çš„count; // è·¨åŒºé—´
```

**æ¯å±‚é€’å½’åªè´Ÿè´£æœ¬å±‚çš„é€†åºå¯¹ï¼Œé€’å½’è¿”å›å€¼ç´¯åŠ æ‰€æœ‰å­é—®é¢˜çš„ç»“æœã€‚**

#### 5. æ˜“é”™ç‚¹æ€»ç»“

| æ˜“é”™ç‚¹ | é”™è¯¯å†™æ³• | æ­£ç¡®å†™æ³• | åŸå›  |
|--------|---------|---------|------|
| cur2åˆå§‹åŒ– | `cur2 = right` | `cur2 = mid + 1` | å³åŠéƒ¨åˆ†ä»mid+1å¼€å§‹ |
| ç¼ºå°‘è¿”å›å€¼ | æ—  `return` | `return count;` | intå‡½æ•°å¿…é¡»è¿”å›å€¼ |
| ç»Ÿè®¡ä½ç½® | åœ¨ifåˆ†æ”¯ç»Ÿè®¡ | åœ¨elseåˆ†æ”¯ç»Ÿè®¡ | åªæœ‰å·¦>å³æ‰æ˜¯é€†åºå¯¹ |
| ç»Ÿè®¡å…¬å¼ | `count++` | `count += (mid - cur1 + 1)` | æ‰¹é‡ç»Ÿè®¡ï¼Œä¸æ˜¯å•ä¸ª |

---

### å¤æ‚åº¦åˆ†æ

**æ—¶é—´å¤æ‚åº¦ï¼š** O(n log n)
- å½’å¹¶æ’åºçš„æ—¶é—´å¤æ‚åº¦ï¼šO(n log n)
- ç»Ÿè®¡é€†åºå¯¹ï¼šåœ¨åˆå¹¶è¿‡ç¨‹ä¸­é¡ºä¾¿å®Œæˆï¼Œä¸å¢åŠ é¢å¤–æ—¶é—´
- æ€»æ—¶é—´ï¼šO(n log n)

**ç©ºé—´å¤æ‚åº¦ï¼š** O(n)
- ä¸´æ—¶æ•°ç»„ tmpï¼šO(n)
- é€’å½’æ ˆï¼šO(log n)
- æ€»ç©ºé—´ï¼šO(n)

**å¯¹æ¯”æš´åŠ›è§£æ³•ï¼š**
```
n = 50000ï¼ˆé¢˜ç›®æœ€å¤§æ•°æ®ï¼‰

æš´åŠ› O(nÂ²)ï¼š
50000 Ã— 50000 / 2 = 1,250,000,000 æ¬¡æ¯”è¾ƒ
â†’ è¶…æ—¶ âŒ

å½’å¹¶ O(n log n)ï¼š
50000 Ã— logâ‚‚(50000) â‰ˆ 50000 Ã— 16 = 800,000 æ¬¡æ“ä½œ
â†’ çº¦ 300ms âœ…

ä¼˜åŒ–æ•ˆæœï¼šå¿«äº† 1000+ å€ï¼
```

---

## 3. è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•° - LeetCode 315

**é¢˜ç›®é“¾æ¥ï¼š** https://leetcode.cn/problems/count-of-smaller-numbers-after-self/

### é¢˜ç›®æè¿°

ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums`ï¼ŒæŒ‰è¦æ±‚è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ `counts`ã€‚æ•°ç»„ `counts` æœ‰è¯¥æ€§è´¨ï¼š `counts[i]` çš„å€¼æ˜¯ `nums[i]` å³ä¾§å°äº `nums[i]` çš„å…ƒç´ çš„æ•°é‡ã€‚

**ç¤ºä¾‹1ï¼š**
```
è¾“å…¥ï¼šnums = [5, 2, 6, 1]
è¾“å‡ºï¼š[2, 1, 1, 0]
è§£é‡Šï¼š
5 çš„å³ä¾§æœ‰ 2 ä¸ªæ›´å°çš„å…ƒç´  (2 å’Œ 1)
2 çš„å³ä¾§æœ‰ 1 ä¸ªæ›´å°çš„å…ƒç´  (1)
6 çš„å³ä¾§æœ‰ 1 ä¸ªæ›´å°çš„å…ƒç´  (1)
1 çš„å³ä¾§æœ‰ 0 ä¸ªæ›´å°çš„å…ƒç´ 
```

**ç¤ºä¾‹2ï¼š**
```
è¾“å…¥ï¼šnums = [-1]
è¾“å‡ºï¼š[0]
```

**ç¤ºä¾‹3ï¼š**
```
è¾“å…¥ï¼šnums = [-1, -1]
è¾“å‡ºï¼š[0, 0]
```

**æç¤ºï¼š**
- `1 <= nums.length <= 10^5`
- `-10^4 <= nums[i] <= 10^4`

---

### è§£é¢˜æ€è·¯

#### ğŸ¤” é—®é¢˜1ï¼šè¿™é“é¢˜å’Œé€†åºå¯¹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**å¯¹æ¯”åˆ†æï¼š**

| é¢˜ç›® | ç»Ÿè®¡ä»€ä¹ˆ | è¿”å›ä»€ä¹ˆ | æ ¸å¿ƒéš¾ç‚¹ |
|------|---------|---------|---------|
| **é€†åºå¯¹** | æ•´ä¸ªæ•°ç»„çš„é€†åºå¯¹æ€»æ•° | ä¸€ä¸ªæ•´æ•° `int` | ç»Ÿè®¡æ€»æ•° |
| **å³ä¾§æ›´å°å…ƒç´ ** | **æ¯ä¸ªå…ƒç´ **å³ä¾§æ›´å°çš„ä¸ªæ•° | ä¸€ä¸ªæ•°ç»„ `vector<int>` | è¿½è¸ªæ¯ä¸ªå…ƒç´ çš„ç»Ÿè®¡ç»“æœ |

**æ ¸å¿ƒåŒºåˆ«ï¼š**
- é€†åºå¯¹ï¼šåªéœ€è¦ä¸€ä¸ª `int count` å˜é‡è®°å½•æ€»æ•°
- å³ä¾§æ›´å°ï¼šéœ€è¦ä¸€ä¸ª `vector<int> count` æ•°ç»„ï¼Œè®°å½•æ¯ä¸ªä½ç½®çš„ç»Ÿè®¡ç»“æœ

---

#### ğŸ¤” é—®é¢˜2ï¼šå½’å¹¶æ’åºä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿ

**é—®é¢˜åœºæ™¯ï¼š**

```
åŸæ•°ç»„ï¼š[5, 2, 6, 1]
       â†‘  â†‘  â†‘  â†‘
     ä¸‹æ ‡0 1  2  3

æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼š
result[0] = ?  â† å…ƒç´ 5ï¼ˆåŸæ¥ä¸‹æ ‡0ï¼‰å³ä¾§æœ‰å¤šå°‘ä¸ªæ›´å°çš„ï¼Ÿ
result[1] = ?  â† å…ƒç´ 2ï¼ˆåŸæ¥ä¸‹æ ‡1ï¼‰å³ä¾§æœ‰å¤šå°‘ä¸ªæ›´å°çš„ï¼Ÿ
result[2] = ?  â† å…ƒç´ 6ï¼ˆåŸæ¥ä¸‹æ ‡2ï¼‰å³ä¾§æœ‰å¤šå°‘ä¸ªæ›´å°çš„ï¼Ÿ
result[3] = ?  â† å…ƒç´ 1ï¼ˆåŸæ¥ä¸‹æ ‡3ï¼‰å³ä¾§æœ‰å¤šå°‘ä¸ªæ›´å°çš„ï¼Ÿ
```

**å½’å¹¶æ’åºåï¼š**

```
æ’åºå‰ï¼š[5, 2, 6, 1]
       â†‘
     ä¸‹æ ‡0çš„å…ƒç´ æ˜¯5

æ’åºåï¼š[1, 2, 5, 6]
          â†‘
     ä¸‹æ ‡0çš„å…ƒç´ å˜æˆ1äº†ï¼

é—®é¢˜ï¼šæ’åºåï¼Œæˆ‘ä»¬è¿˜èƒ½çŸ¥é“åŸæ¥ä¸‹æ ‡0çš„å…ƒç´ ï¼ˆ5ï¼‰åœ¨å“ªå—ï¼ŸâŒ
```

**å…³é”®é—®é¢˜ï¼š** å½’å¹¶æ’åºä¼šæ”¹å˜å…ƒç´ ä½ç½®ï¼Œæˆ‘ä»¬æ— æ³•è¿½è¸ª"åŸæ¥ä¸‹æ ‡0çš„å…ƒç´ "ç»Ÿè®¡äº†å¤šå°‘ä¸ªï¼

---

#### ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼šç´¢å¼•æ•°ç»„

**æ ¸å¿ƒæ€æƒ³ï¼š** ä¸ç›´æ¥æ’åº `nums`ï¼Œè€Œæ˜¯æ’åº**ç´¢å¼•æ•°ç»„**ï¼

**ä»€ä¹ˆæ˜¯ç´¢å¼•æ•°ç»„ï¼Ÿ**

```
åŸæ•°ç»„ï¼šnums = [5, 2, 6, 1]
              â†‘  â†‘  â†‘  â†‘
            ä¸‹æ ‡0 1  2  3

ç´¢å¼•æ•°ç»„ï¼šindex = [0, 1, 2, 3]

index[0] = 0  â†’ æŒ‡å‘ nums[0] = 5
index[1] = 1  â†’ æŒ‡å‘ nums[1] = 2
index[2] = 2  â†’ æŒ‡å‘ nums[2] = 6
index[3] = 3  â†’ æŒ‡å‘ nums[3] = 1
```

**æ’åºç´¢å¼•æ•°ç»„ï¼š**

```
æˆ‘ä»¬ä¸æ˜¯æŒ‰ index[i] çš„å€¼æ’åº
è€Œæ˜¯æŒ‰ nums[index[i]] çš„å€¼æ’åºï¼

åˆå§‹ï¼š
index = [0, 1, 2, 3]
        â†“  â†“  â†“  â†“
nums  = [5, 2, 6, 1]

æ’åºåï¼š
index = [3, 1, 0, 2]
        â†“  â†“  â†“  â†“
nums  = [1, 2, 5, 6]  â† é€šè¿‡ index çœ‹åˆ°çš„æœ‰åºåºåˆ—

å…³é”®ï¼šindex[2] = 0 ä»ç„¶è®°å½•ç€"å…ƒç´ 5çš„åŸå§‹ä½ç½®æ˜¯0"ï¼
```

**ä¼˜åŠ¿ï¼š**
- `nums` æœ¬èº«ä¸åŠ¨
- `index` æ’åºåï¼Œ`index[i]` ä»ç„¶è®°å½•ç€åŸå§‹ä½ç½®
- æˆ‘ä»¬èƒ½è¿½è¸ªåˆ°æ¯ä¸ªå…ƒç´ çš„ç»Ÿè®¡ç»“æœ

---

#### ğŸ¤” é—®é¢˜3ï¼šä»€ä¹ˆæ—¶å€™ç»Ÿè®¡ï¼Ÿæ€ä¹ˆç»Ÿè®¡ï¼Ÿ

**å½’å¹¶æ’åºçš„åˆå¹¶è¿‡ç¨‹ï¼š**

```
å·¦è¾¹ï¼š[2, 5]  (å·²æ’åºï¼Œé€šè¿‡ index çœ‹åˆ°çš„)
      â†‘
    cur1

å³è¾¹ï¼š[1, 6]  (å·²æ’åºï¼Œé€šè¿‡ index çœ‹åˆ°çš„)
      â†‘
    cur2

æ¯”è¾ƒï¼šnums[index[cur1]] vs nums[index[cur2]]
     å³ 2 vs 1
```

**å…³é”®æ´å¯Ÿï¼š**

åœ¨å½’å¹¶æ’åºä¸­ï¼Œ**å³è¾¹åŒºé—´**çš„å…ƒç´ éƒ½åœ¨åŸæ•°ç»„ä¸­ä½äº**å·¦è¾¹å…ƒç´ çš„å³ä¾§**ï¼

```
åŸæ•°ç»„ï¼š[5, 2, 6, 1]
        â†‘     â†‘  â†‘
      å·¦è¾¹  å³è¾¹åŒºé—´
      
5 çš„å³ä¾§ï¼š[2, 6, 1]
å³è¾¹åŒºé—´ï¼š[6, 1]
```

**ç»Ÿè®¡æ—¶æœºï¼š**

å½“æˆ‘ä»¬å–å·¦è¾¹çš„å…ƒç´ æ—¶ï¼ˆ`nums[index[cur1]] <= nums[index[cur2]]`ï¼‰ï¼š
- æ­¤æ—¶å³è¾¹æœ‰ä¸€äº›å…ƒç´ å·²ç»è¢«å–èµ°äº†ï¼ˆæ”¾è¿› `tmp` äº†ï¼‰
- è¿™äº›å…ƒç´ ä¸€å®šæ¯”å·¦è¾¹å½“å‰å…ƒç´ å°ï¼ˆå› ä¸ºå…ˆè¢«å–èµ°ï¼‰
- è€Œä¸”å®ƒä»¬åœ¨åŸæ•°ç»„ä¸­ä½äºå·¦è¾¹å…ƒç´ çš„å³ä¾§

**æ‰€ä»¥ï¼šå³è¾¹å·²ç»è¢«å–èµ°çš„å…ƒç´ ä¸ªæ•° = å·¦è¾¹å½“å‰å…ƒç´ å³ä¾§æ›´å°çš„ä¸ªæ•°ï¼**

---

**"å·²è¢«å–èµ°"çš„ä¸ªæ•°å¦‚ä½•è®¡ç®—ï¼Ÿ**

```
å³è¾¹åŒºé—´åˆå§‹ä½ç½®ï¼šmid + 1
å³è¾¹å½“å‰ä½ç½®ï¼šcur2

ä¾‹å­ï¼š
åˆå§‹ï¼šcur2 = mid + 1 = 3
ç°åœ¨ï¼šcur2 = 5

è¯´æ˜ï¼šä¸‹æ ‡3, 4çš„å…ƒç´ å·²ç»è¢«å–èµ°äº† â†’ 2ä¸ª

å…¬å¼ï¼šcur2 - (mid + 1) = 5 - 3 = 2
åŒ–ç®€ï¼šcur2 - mid - 1
```

---

**è¾¹ç•Œæƒ…å†µï¼šå·¦è¾¹å‰©ä½™**

```
å·¦è¾¹ï¼š[5, 7, 9]
            â†‘ â†‘
          cur1è¿˜å‰©è¿™äº›

å³è¾¹ï¼š[1, 2, 6]
               â†‘
             cur2 > right (å³è¾¹éå†å®Œäº†)

é—®ï¼šæ­¤æ—¶å·¦è¾¹å‰©ä½™çš„å…ƒç´ ï¼ˆ7, 9ï¼‰å³ä¾§æœ‰å¤šå°‘ä¸ªæ›´å°çš„ï¼Ÿ
ç­”ï¼šå³è¾¹æ‰€æœ‰å…ƒç´ éƒ½è¢«å–èµ°äº†ï¼Œæ€»å…± right - mid ä¸ª
```

---

### æˆ‘çš„ä»£ç 

#### åˆå§‹æ€è·¯

ä¸€å¼€å§‹ä¸çŸ¥é“æ€ä¹ˆå¤„ç†è¿”å›å€¼å’Œç»Ÿè®¡é—®é¢˜ï¼š

```cpp
class Solution {
public:
    vector<int> tmp;
    vector<int> countSmaller(vector<int>& nums) {
        // ç”±å¤§åˆ°å°æ’ï¼Ÿåˆ©ç”¨åˆ†æ²»ï¼Œæ’åºæ—¶é¡ºä¾¿ç»Ÿè®¡ä¸ªæ•°ï¼Œå¤šä¼ ä¸€ä¸ªå€¼çš„å‚æ•°ï¼Ÿ
        tmp.resize(nums.size());
        return mergeSort(nums, 0, nums.size() - 1);
    }
    vector<int> mergeSort(vector<int>& nums, int left, int right) {
        vector<int> ret{};  // å…ˆç»Ÿè®¡ä¸ªæ•°ï¼Œæœ€åå‹è¿›å»ï¼Ÿä¼˜åŒ–ç»Ÿè®¡æ–¹å¼ï¼Ÿ
        if(left >= right) return ;
        int mid = (left + right) >> 1;
        // ...
    }
};
```

**å›°æƒ‘ç‚¹ï¼š**
1. è¿”å›å€¼æ€ä¹ˆå¤„ç†ï¼Ÿ
2. å¦‚ä½•è®°å½•æ¯ä¸ªå…ƒç´ çš„ç»Ÿè®¡ç»“æœï¼Ÿ
3. ç»Ÿè®¡å…¬å¼æ˜¯ `mid - cur1 + 1` å—ï¼Ÿä½†æ€ä¹ˆå’Œæ•°ç»„å…³è”ï¼Ÿ

---

#### ç†è§£è¿‡ç¨‹ï¼ˆè‹æ ¼æ‹‰åº•å¼å¼•å¯¼ï¼‰

**ç¬¬1æ­¥ï¼š** è®¤è¯†åˆ°æ ¸å¿ƒåŒºåˆ«
- é€†åºå¯¹ï¼šç»Ÿè®¡æ•´ä½“æ€»æ•° â†’ è¿”å› `int`
- è¿™é“é¢˜ï¼šç»Ÿè®¡æ¯ä¸ªå…ƒç´  â†’ è¿”å› `vector<int>`ï¼Œéœ€è¦è¿½è¸ª

**ç¬¬2æ­¥ï¼š** ç†è§£å½’å¹¶æ’åºçš„é—®é¢˜
- æ’åºåå…ƒç´ ä½ç½®å˜äº†
- æ— æ³•è¿½è¸ª"åŸæ¥ä¸‹æ ‡0çš„å…ƒç´ "

**ç¬¬3æ­¥ï¼š** å¼•å…¥ç´¢å¼•æ•°ç»„
- åˆ›å»º `index = [0, 1, 2, 3, ...]`
- æ’åº `index`ï¼Œä½†æ¯”è¾ƒ `nums[index[i]]`
- `index` è®°å½•åŸå§‹ä½ç½®

**ç¬¬4æ­¥ï¼š** ç†è§£ç»Ÿè®¡æ—¶æœº
- å½“å–å·¦è¾¹å…ƒç´ æ—¶ï¼Œç»Ÿè®¡å³è¾¹å·²å–èµ°çš„ä¸ªæ•°
- å…¬å¼ï¼š`cur2 - mid - 1`

**ç¬¬5æ­¥ï¼š** å¤„ç†è¾¹ç•Œ
- å·¦è¾¹å‰©ä½™ï¼šç»Ÿè®¡ `right - mid`
- å³è¾¹å‰©ä½™ï¼šä¸éœ€è¦ç»Ÿè®¡

**ç¬¬6æ­¥ï¼š** æ•°æ®ç»“æ„è®¾è®¡
- æˆå‘˜å˜é‡ï¼š`tmp`ï¼ˆä¸´æ—¶æ•°ç»„ï¼‰ã€`count`ï¼ˆç»“æœæ•°ç»„ï¼‰ã€`nums`ï¼ˆåŸæ•°ç»„ï¼‰
- å‡½æ•°ç­¾åï¼š`void mergeSort(vector<int>& index, int left, int right)`

---

#### ACä»£ç  â­

```cpp
class Solution {
public:
    vector<int> tmp;     // ä¸´æ—¶æ•°ç»„ï¼ˆå­˜ç´¢å¼•ï¼‰
    vector<int> count;   // ç»“æœæ•°ç»„ï¼ˆå­˜ç»Ÿè®¡ç»“æœï¼‰
    vector<int> nums;    // åŸæ•°ç»„ï¼ˆç”¨æ¥æ¯”è¾ƒï¼‰
    
    vector<int> countSmaller(vector<int>& nums) {
        int n = nums.size();
        
        // ä¿å­˜åŸæ•°ç»„åˆ°æˆå‘˜å˜é‡
        this->nums = nums;
        
        // åˆ›å»ºç´¢å¼•æ•°ç»„
        vector<int> index(n);
        for(int i = 0; i < n; i++) {
            index[i] = i;  // [0, 1, 2, 3, ...]
        }
        
        // åˆå§‹åŒ– count å’Œ tmp
        count.resize(n, 0);
        tmp.resize(n);
        
        // å½’å¹¶æ’åºç´¢å¼•æ•°ç»„
        mergeSort(index, 0, n - 1);
        
        return count;
    }
    
    void mergeSort(vector<int>& index, int left, int right) {
        if(left >= right) return;
        
        int mid = (left + right) >> 1;
        
        // é€’å½’æ’åº index çš„å·¦å³ä¸¤éƒ¨åˆ†
        mergeSort(index, left, mid);
        mergeSort(index, mid + 1, right);
        
        // åˆå¹¶
        int cur1 = left, cur2 = mid + 1;
        int k = left;
        
        while(cur1 <= mid && cur2 <= right) {
            // æ¯”è¾ƒ nums[index[cur1]] å’Œ nums[index[cur2]]
            if(nums[index[cur1]] <= nums[index[cur2]]) {
                // å·¦è¾¹å°ï¼Œç»Ÿè®¡å³è¾¹å·²å–èµ°çš„ä¸ªæ•°
                count[index[cur1]] += (cur2 - mid - 1);
                tmp[k++] = index[cur1++];
            } else {
                // å³è¾¹å°ï¼Œå–å³è¾¹
                tmp[k++] = index[cur2++];
            }
        }
        
        // å¤„ç†å·¦è¾¹å‰©ä½™
        while(cur1 <= mid) {
            // å³è¾¹å…¨éƒ¨å–å®Œäº†ï¼Œç»Ÿè®¡å³è¾¹æ€»ä¸ªæ•°
            count[index[cur1]] += (right - mid);
            tmp[k++] = index[cur1++];
        }
        
        // å¤„ç†å³è¾¹å‰©ä½™ï¼ˆä¸éœ€è¦ç»Ÿè®¡ï¼‰
        while(cur2 <= right) {
            tmp[k++] = index[cur2++];
        }
        
        // æ‹·è´å› index
        for(int i = left; i <= right; i++) {
            index[i] = tmp[i];
        }
    }
};
```

**æ—¶é—´ï¼š** çº¦ 400ms  
**å‡»è´¥ï¼š** çº¦ 60% ç”¨æˆ·

---

### æ ¸å¿ƒç†è§£

#### 1. ç´¢å¼•æ•°ç»„çš„ä½œç”¨

**ä¸ºä»€ä¹ˆéœ€è¦ç´¢å¼•æ•°ç»„ï¼Ÿ**

```
é—®é¢˜ï¼šå½’å¹¶æ’åºä¼šæ”¹å˜å…ƒç´ ä½ç½®
è§£å†³ï¼šæ’åºç´¢å¼•ï¼Œè€Œä¸æ˜¯å…ƒç´ æœ¬èº«

index æ•°ç»„çš„å«ä¹‰ï¼š
index[i] è®°å½•çš„æ˜¯"ç¬¬iä¸ªä½ç½®ä¸Šå…ƒç´ çš„åŸå§‹ä¸‹æ ‡"

æ’åºåï¼š
index = [3, 1, 0, 2]
       â†“  â†“  â†“  â†“
     åŸå§‹ä¸‹æ ‡ï¼Œæ°¸è¿œä¸å˜ï¼
```

**å…³é”®æ“ä½œï¼š**
- æ¯”è¾ƒï¼š`nums[index[cur1]]` vs `nums[index[cur2]]`
- äº¤æ¢ï¼šäº¤æ¢ `index` é‡Œçš„å€¼ï¼Œä¸æ˜¯ `nums`
- ç»Ÿè®¡ï¼š`count[index[cur1]] += ...`ï¼ˆç”¨åŸå§‹ä¸‹æ ‡æ›´æ–°ç»“æœï¼‰

---

#### 2. ç»Ÿè®¡å…¬å¼æ¨å¯¼

**æƒ…å†µ1ï¼šå·¦è¾¹å…ƒç´ è¢«å–èµ°æ—¶**

```cpp
if(nums[index[cur1]] <= nums[index[cur2]]) {
    count[index[cur1]] += (cur2 - mid - 1);
    tmp[k++] = index[cur1++];
}
```

**ä¸ºä»€ä¹ˆæ˜¯ `cur2 - mid - 1`ï¼Ÿ**

```
å³è¾¹åŒºé—´ï¼š[mid+1, ..., cur2-1, cur2, ..., right]
         â†‘                 â†‘
       å¼€å§‹ä½ç½®          å½“å‰ä½ç½®
       
å·²ç»è¢«å–èµ°çš„ï¼šä» mid+1 åˆ° cur2-1
ä¸ªæ•°ï¼š(cur2 - 1) - (mid + 1) + 1 = cur2 - mid - 1
```

**ä¾‹å­éªŒè¯ï¼š**
```
mid = 4, cur2 = 7

å·²å–èµ°ï¼šä¸‹æ ‡ 5, 6 â†’ 2ä¸ª
å…¬å¼ï¼š7 - 4 - 1 = 2 âœ…
```

---

**æƒ…å†µ2ï¼šå·¦è¾¹å‰©ä½™æ—¶**

```cpp
while(cur1 <= mid) {
    count[index[cur1]] += (right - mid);
    tmp[k++] = index[cur1++];
}
```

**ä¸ºä»€ä¹ˆæ˜¯ `right - mid`ï¼Ÿ**

```
å³è¾¹åŒºé—´ï¼š[mid+1, mid+2, ..., right]

ä» mid+1 åˆ° rightï¼Œå…±å¤šå°‘ä¸ªï¼Ÿ
right - (mid + 1) + 1 = right - mid
```

---

#### 3. æ•°æ®ç»“æ„è®¾è®¡

**æˆå‘˜å˜é‡ï¼š**

| å˜é‡ | ç±»å‹ | ä½œç”¨ |
|------|------|------|
| `nums` | `vector<int>` | ä¿å­˜åŸæ•°ç»„ï¼Œç”¨æ¥æ¯”è¾ƒ `nums[index[i]]` |
| `index` | `vector<int>` | å±€éƒ¨å˜é‡ï¼Œè®°å½•å…ƒç´ çš„åŸå§‹ä¸‹æ ‡ |
| `tmp` | `vector<int>` | ä¸´æ—¶æ•°ç»„ï¼Œå­˜æ”¾æ’åºä¸­çš„ `index` |
| `count` | `vector<int>` | ç»“æœæ•°ç»„ï¼Œ`count[i]` = åŸå§‹ä¸‹æ ‡içš„ç»Ÿè®¡ç»“æœ |

**å‡½æ•°ç­¾åï¼š**

```cpp
void mergeSort(vector<int>& index, int left, int right)
```

- åªä¼  `index`ï¼Œå› ä¸ºå…¶ä»–éƒ½æ˜¯æˆå‘˜å˜é‡
- ä¸è¿”å›å€¼ï¼ˆ`void`ï¼‰ï¼Œç»Ÿè®¡ç»“æœä¿å­˜åœ¨ `count` ä¸­

---

#### 4. å’Œé€†åºå¯¹çš„å¯¹æ¯”

| å¯¹æ¯”é¡¹ | é€†åºå¯¹ | å³ä¾§æ›´å°å…ƒç´  |
|--------|--------|-------------|
| **ç»Ÿè®¡å¯¹è±¡** | æ•´ä¸ªæ•°ç»„çš„æ€»æ•° | æ¯ä¸ªå…ƒç´ å„è‡ªçš„ä¸ªæ•° |
| **è¿”å›å€¼** | `int` | `vector<int>` |
| **æ’åºå¯¹è±¡** | ç›´æ¥æ’åº `nums` | æ’åºç´¢å¼•æ•°ç»„ `index` |
| **æ¯”è¾ƒä¾æ®** | `nums[cur1]` vs `nums[cur2]` | `nums[index[cur1]]` vs `nums[index[cur2]]` |
| **ç»Ÿè®¡æ—¶æœº** | `else` åˆ†æ”¯ï¼ˆå³è¾¹å°ï¼‰ | `if` åˆ†æ”¯ï¼ˆå·¦è¾¹å°ï¼‰ |
| **ç»Ÿè®¡å…¬å¼** | `count += (mid - cur1 + 1)` | `count[index[cur1]] += (cur2 - mid - 1)` |
| **æ•°æ®ç»“æ„** | `int count` | `vector<int> count` + ç´¢å¼•æ•°ç»„ |

**æ ¸å¿ƒåŒºåˆ«ï¼š**
- é€†åºå¯¹ï¼šç»Ÿè®¡"å·¦è¾¹>å³è¾¹"çš„æƒ…å†µ
- è¿™é“é¢˜ï¼šç»Ÿè®¡"å·¦è¾¹å…ƒç´ å³ä¾§æœ‰å¤šå°‘ä¸ªæ›´å°çš„"ï¼Œå½“å·¦è¾¹è¢«å–èµ°æ—¶ç»Ÿè®¡

---

#### 5. æ˜“é”™ç‚¹æ€»ç»“

| æ˜“é”™ç‚¹ | é”™è¯¯å†™æ³• | æ­£ç¡®å†™æ³• | åŸå›  |
|--------|---------|---------|------|
| æ’åºå¯¹è±¡ | `mergeSort(nums, ...)` | `mergeSort(index, ...)` | è¦æ’åºç´¢å¼•ï¼Œä¸æ˜¯å…ƒç´  |
| æ¯”è¾ƒä¾æ® | `if(index[cur1] <= index[cur2])` | `if(nums[index[cur1]] <= nums[index[cur2]])` | æ¯”è¾ƒçš„æ˜¯å…ƒç´ å€¼ï¼Œä¸æ˜¯ä¸‹æ ‡ |
| ç»Ÿè®¡å…¬å¼ | `count[cur1] += ...` | `count[index[cur1]] += ...` | ç”¨åŸå§‹ä¸‹æ ‡æ›´æ–°ç»“æœ |
| ç»Ÿè®¡æ—¶æœº | `else` åˆ†æ”¯ç»Ÿè®¡ | `if` åˆ†æ”¯ç»Ÿè®¡ï¼ˆå·¦è¾¹å°æ—¶ï¼‰ | å’Œé€†åºå¯¹ç›¸å |
| è¾¹ç•Œå¤„ç† | å¿˜è®°å¤„ç†å·¦è¾¹å‰©ä½™ | `count[index[cur1]] += (right - mid)` | å³è¾¹å…¨éƒ¨å–å®Œè¦ç»Ÿè®¡ |

---

### å¤æ‚åº¦åˆ†æ

**æ—¶é—´å¤æ‚åº¦ï¼š** O(n log n)
- å½’å¹¶æ’åºçš„æ—¶é—´å¤æ‚åº¦ï¼šO(n log n)
- ç»Ÿè®¡æ“ä½œï¼šåœ¨åˆå¹¶è¿‡ç¨‹ä¸­é¡ºä¾¿å®Œæˆï¼Œä¸å¢åŠ é¢å¤–æ—¶é—´
- æ€»æ—¶é—´ï¼šO(n log n)

**ç©ºé—´å¤æ‚åº¦ï¼š** O(n)
- ç´¢å¼•æ•°ç»„ `index`ï¼šO(n)
- ä¸´æ—¶æ•°ç»„ `tmp`ï¼šO(n)
- ç»“æœæ•°ç»„ `count`ï¼šO(n)
- é€’å½’æ ˆï¼šO(log n)
- æ€»ç©ºé—´ï¼šO(n)

**å¯¹æ¯”æš´åŠ›è§£æ³•ï¼š**
```
æš´åŠ›è§£æ³•ï¼š
for(int i = 0; i < n; i++) {
    for(int j = i + 1; j < n; j++) {
        if(nums[j] < nums[i]) count[i]++;
    }
}

æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²)
n = 10^5 æ—¶ï¼š10^10 æ¬¡æ“ä½œ â†’ è¶…æ—¶ âŒ

å½’å¹¶æ’åºï¼šO(n log n)
n = 10^5 æ—¶ï¼šçº¦ 10^5 Ã— 17 = 1.7 Ã— 10^6 æ¬¡æ“ä½œ â†’ AC âœ…

ä¼˜åŒ–æ•ˆæœï¼šå¿«äº† 5000+ å€ï¼
```

---

### å­¦ä¹ æ”¶è·

#### 1. ç´¢å¼•æ•°ç»„æŠ€å·§

è¿™æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æŠ€å·§ï¼Œé€‚ç”¨äºï¼š
- éœ€è¦åœ¨æ’åºçš„åŒæ—¶è¿½è¸ªå…ƒç´ åŸå§‹ä½ç½®
- éœ€è¦å¯¹æ¯ä¸ªå…ƒç´ å•ç‹¬ç»Ÿè®¡ç»“æœ
- ä¸èƒ½ç›´æ¥ä¿®æ”¹åŸæ•°ç»„

**æ¨¡æ¿ï¼š**
```cpp
// åˆ›å»ºç´¢å¼•æ•°ç»„
vector<int> index(n);
for(int i = 0; i < n; i++) index[i] = i;

// æ’åºç´¢å¼•ï¼Œæ¯”è¾ƒå…ƒç´ 
sort(index.begin(), index.end(), [&](int i, int j) {
    return nums[i] < nums[j];
});
```

#### 2. å½’å¹¶æ’åºçš„çµæ´»åº”ç”¨

å½’å¹¶æ’åºä¸ä»…ä»…æ˜¯æ’åºï¼Œè¿˜å¯ä»¥ï¼š
- ç»Ÿè®¡é€†åºå¯¹ï¼ˆé¢˜2ï¼‰
- ç»Ÿè®¡å³ä¾§æ›´å°å…ƒç´ ï¼ˆé¢˜3ï¼‰
- ç»Ÿè®¡ç¿»è½¬å¯¹ï¼ˆé¢˜4ï¼Œæ˜å¤©åšï¼‰

**æ ¸å¿ƒï¼š** åœ¨åˆå¹¶ä¸¤ä¸ªæœ‰åºåŒºé—´æ—¶ï¼Œåˆ©ç”¨æœ‰åºæ€§æ‰¹é‡ç»Ÿè®¡ä¿¡æ¯

#### 3. å­¦ä¹ æ–¹æ³•çš„åæ€

**ä»Šå¤©è¿™é“é¢˜çš„å­¦ä¹ è¿‡ç¨‹ï¼š**
- è€—æ—¶ï¼šçº¦ 1 å°æ—¶ 40 åˆ†é’Ÿ
- æ–¹æ³•ï¼šè‹æ ¼æ‹‰åº•å¼å¼•å¯¼ï¼Œä¸€æ­¥æ­¥æ¨å¯¼
- ç»“æœï¼šå®Œå…¨ç†è§£ï¼Œä»£ç ä¸€æ¬¡AC

**æ”¶è·ï¼š**
- æ¯”ç›´æ¥çœ‹é¢˜è§£çš„ç†è§£æ›´æ·±åˆ»
- æŒæ¡äº†ç´¢å¼•æ•°ç»„è¿™ä¸ªé€šç”¨æŠ€å·§
- åŸ¹å…»äº†ä»é—®é¢˜å‡ºå‘æ¨å¯¼è§£æ³•çš„èƒ½åŠ›

**æ„Ÿæ‚Ÿï¼š**
> æ…¢å°±æ˜¯å¿«ã€‚èŠ±æ—¶é—´æ·±åº¦ç†è§£ä¸€é“é¢˜ï¼Œèƒœè¿‡å¿«é€Ÿåˆ·åé“é¢˜ã€‚
> ä»Šå¤©å­¦çš„ç´¢å¼•æ•°ç»„æŠ€å·§ï¼Œæ˜å¤©å°±èƒ½ç›´æ¥ç”¨åˆ°ç¿»è½¬å¯¹é—®é¢˜ä¸Šã€‚
> è¿™å°±æ˜¯æ·±åº¦å­¦ä¹ çš„å¤åˆ©æ•ˆåº”ã€‚

---

## 4. ç¿»è½¬å¯¹ - LeetCode 493

**é¢˜ç›®é“¾æ¥ï¼š** https://leetcode.cn/problems/reverse-pairs/

### é¢˜ç›®æè¿°

ç»™å®šä¸€ä¸ªæ•°ç»„ `nums`ï¼Œå¦‚æœ `i < j` ä¸” `nums[i] > 2 * nums[j]`ï¼Œæˆ‘ä»¬å°±å°† `(i, j)` ç§°ä½œä¸€ä¸ª**é‡è¦ç¿»è½¬å¯¹**ã€‚

ä½ éœ€è¦è¿”å›ç»™å®šæ•°ç»„ä¸­çš„é‡è¦ç¿»è½¬å¯¹çš„æ•°é‡ã€‚

**ç¤ºä¾‹1ï¼š**
```
è¾“å…¥ï¼šnums = [1, 3, 2, 3, 1]
è¾“å‡ºï¼š2
```

**ç¤ºä¾‹2ï¼š**
```
è¾“å…¥ï¼šnums = [2, 4, 3, 5, 1]
è¾“å‡ºï¼š3
```

**æç¤ºï¼š**
- `1 <= nums.length <= 5 * 10^4`
- `-2^31 <= nums[i] <= 2^31 - 1`

---

### è§£é¢˜æ€è·¯

#### ğŸ¤” é—®é¢˜1ï¼šè¿™é“é¢˜å’Œé€†åºå¯¹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**å¯¹æ¯”åˆ†æï¼š**

| é¢˜ç›® | æ¡ä»¶ | èƒ½å¦åœ¨å½’å¹¶æ—¶ç»Ÿè®¡ï¼Ÿ |
|------|------|------------------|
| **é€†åºå¯¹** | `nums[i] > nums[j]` | âœ… å¯ä»¥ |
| **ç¿»è½¬å¯¹** | `nums[i] > 2 * nums[j]` | âŒ ä¸è¡Œ |

**æ ¸å¿ƒåŒºåˆ«ï¼š**
- é€†åºå¯¹ï¼šç»Ÿè®¡æ¡ä»¶ = å½’å¹¶æ’åºçš„æ¯”è¾ƒæ¡ä»¶
- ç¿»è½¬å¯¹ï¼šç»Ÿè®¡æ¡ä»¶ â‰  å½’å¹¶æ’åºçš„æ¯”è¾ƒæ¡ä»¶

---

#### ğŸ¤” é—®é¢˜2ï¼šä¸ºä»€ä¹ˆä¸èƒ½åœ¨å½’å¹¶æ—¶ä¸€èµ·ç»Ÿè®¡ï¼Ÿ

**é€†åºå¯¹ï¼ˆå¯ä»¥ä¸€èµ·ï¼‰ï¼š**

```cpp
while(cur1 <= mid && cur2 <= right) {
    if(nums[cur1] <= nums[cur2]) {
        // å½’å¹¶æ¡ä»¶ï¼šå·¦è¾¹ â‰¤ å³è¾¹
        tmp[k++] = nums[cur1++];
    } else {
        // ç»Ÿè®¡æ¡ä»¶ï¼šå·¦è¾¹ > å³è¾¹ï¼ˆå’Œå½’å¹¶æ¡ä»¶äº’è¡¥ï¼‰
        tmp[k++] = nums[cur2++];
        count += (mid - cur1 + 1);  // å¯ä»¥åœ¨è¿™é‡Œç»Ÿè®¡
    }
}
```

**ç¿»è½¬å¯¹ï¼ˆä¸èƒ½ä¸€èµ·ï¼‰ï¼š**

```
å½’å¹¶æ¡ä»¶ï¼šnums[cur1] <= nums[cur2]  â† å†³å®šå–è°
ç»Ÿè®¡æ¡ä»¶ï¼šnums[cur1] > 2 * nums[cur2]  â† åˆ¤æ–­æ˜¯å¦æ˜¯ç¿»è½¬å¯¹

è¿™ä¸¤ä¸ªæ¡ä»¶ä¸ä¸€æ ·ï¼ä¸èƒ½ç”¨ç»Ÿè®¡æ¡ä»¶æ¥å†³å®šå–è°ï¼
```

**ä¸¾ä¾‹è¯´æ˜ï¼š**

```
å·¦è¾¹ï¼š[10]
å³è¾¹ï¼š[5, 8]

å½’å¹¶æ’åºï¼š
10 vs 5 â†’ 5å°ï¼Œå–5
10 vs 8 â†’ 8å°ï¼Œå–8
å–10
ç»“æœï¼š[5, 8, 10]

ç¿»è½¬å¯¹ç»Ÿè®¡ï¼š
10 > 2*5 (10)? âŒ â†’ ä¸æ˜¯ç¿»è½¬å¯¹
10 > 2*8 (16)? âŒ â†’ ä¸æ˜¯ç¿»è½¬å¯¹

å¦‚æœç”¨ nums[cur1] > 2 * nums[cur2] æ¥å†³å®šå–è°ï¼š
10 vs 5 â†’ 10 > 10? âŒ â†’ å–10ï¼Ÿ
è¿™å°±ä¹±å¥—äº†ï¼å½’å¹¶æ’åºä¼šé”™ï¼
```

---

#### ğŸ’¡ æ­£ç¡®æ€è·¯ï¼šåˆ†ä¸¤æ­¥

**Step 1ï¼šå…ˆç»Ÿè®¡è·¨åŒºé—´çš„ç¿»è½¬å¯¹**

```cpp
// åœ¨åˆå¹¶ä¹‹å‰ï¼Œå…ˆç»Ÿè®¡ç¿»è½¬å¯¹
int cur1 = left, cur2 = mid + 1;
while(cur1 <= mid) {
    // å¯¹äºå·¦è¾¹çš„æ¯ä¸ªå…ƒç´ ï¼Œæ‰¾å³è¾¹æœ‰å¤šå°‘ä¸ªæ»¡è¶³æ¡ä»¶
    while(cur2 <= right && nums[cur1] > 2LL * nums[cur2]) {
        cur2++;
    }
    count += (cur2 - mid - 1);
    cur1++;
}
```

**Step 2ï¼šå†æ­£å¸¸å½’å¹¶æ’åº**

```cpp
// é‡ç½®æŒ‡é’ˆï¼Œæ­£å¸¸åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„
cur1 = left;
cur2 = mid + 1;
int k = left;

while(cur1 <= mid && cur2 <= right) {
    if(nums[cur1] <= nums[cur2]) {
        tmp[k++] = nums[cur1++];
    } else {
        tmp[k++] = nums[cur2++];
    }
}
```

---

### æˆ‘çš„ä»£ç 

#### åˆå§‹é”™è¯¯ç‰ˆæœ¬

```cpp
class Solution {
public:
    vector<int> tmp;
    int reversePairs(vector<int>& nums) {
        int n = nums.size();
        tmp.resize(n);
        return mergeSort(nums, 0, n-1);
    }
    
    int mergeSort(vector<int>& nums, int left, int right) {
        if(left >= right) return 0;

        int mid = left + (right - left) / 2;
        int count = 0;

        count += mergeSort(nums, left, mid) + mergeSort(nums, mid+1, right);
        
        // åˆå¹¶ï¼Œç»Ÿè®¡è·¨è¶Šä¸¤åŒºçš„ç¿»è½¬å¯¹
        int cur1 = left, cur2 = mid + 1;
        int k = left;

        while(cur1 <= mid && cur2 <= right) {
            if(nums[cur1] <= 2*nums[cur2]) {  // âŒ é”™è¯¯1ï¼šæ¡ä»¶åäº†
                tmp[k++] = nums[cur1++];
            } else {
                tmp[k++] = nums[cur2++];
                count += mid - cur1 + 1;
            }
        }
        while(cur1 <= mid) tmp[k++] = nums[cur2++];  // âŒ é”™è¯¯2ï¼šåº”è¯¥æ˜¯cur1++
        while(cur2 <= right) tmp[k++] = nums[cur2++];
        
        for(int i = left; i <= right; i++) {
            nums[i] = tmp[i];
        }
        return count;
    }
};
```

**é”™è¯¯åˆ†æï¼š**

1. **é”™è¯¯1ï¼šæŠŠç»Ÿè®¡æ¡ä»¶å½“æˆå½’å¹¶æ¡ä»¶**
   - ç”¨ `nums[cur1] <= 2*nums[cur2]` æ¥å†³å®šå–è°
   - è¿™ä¼šå¯¼è‡´å½’å¹¶æ’åºé”™è¯¯ï¼
   - åº”è¯¥åˆ†ä¸¤æ­¥ï¼šå…ˆç»Ÿè®¡ï¼Œå†å½’å¹¶

2. **é”™è¯¯2ï¼šå¤„ç†å‰©ä½™å…ƒç´ æ—¶å†™é”™**
   - `while(cur1 <= mid) tmp[k++] = nums[cur2++];`
   - åº”è¯¥æ˜¯ `nums[cur1++]`ï¼Œä¸æ˜¯ `nums[cur2++]`

3. **é”™è¯¯3ï¼šå¯èƒ½æ•´æ•°æº¢å‡º**
   - `2*nums[cur2]` å¯èƒ½æº¢å‡º
   - åº”è¯¥ç”¨ `2LL * nums[cur2]`

**è¿è¡Œé”™è¯¯ï¼š** heap-buffer-overflowï¼ˆæ•°ç»„è¶Šç•Œï¼‰

---

#### ç†è§£è¿‡ç¨‹ï¼ˆè‹æ ¼æ‹‰åº•å¼å¼•å¯¼ï¼‰

**ç¬¬1æ­¥ï¼š** è®¤è¯†åˆ°æ ¸å¿ƒé—®é¢˜
- é€†åºå¯¹çš„æ¡ä»¶å’Œå½’å¹¶æ¡ä»¶æ˜¯äº’è¡¥çš„
- ç¿»è½¬å¯¹çš„æ¡ä»¶å’Œå½’å¹¶æ¡ä»¶ä¸ä¸€æ ·
- ä¸èƒ½æ··åœ¨ä¸€èµ·

**ç¬¬2æ­¥ï¼š** ç†è§£ä¸ºä»€ä¹ˆè¦åˆ†ä¸¤æ­¥
- ç»Ÿè®¡ç¿»è½¬å¯¹ï¼šç”¨ç¿»è½¬å¯¹çš„æ¡ä»¶
- å½’å¹¶æ’åºï¼šç”¨å½’å¹¶çš„æ¡ä»¶
- ä¸¤ä¸ªè¿‡ç¨‹ç‹¬ç«‹è¿›è¡Œ

**ç¬¬3æ­¥ï¼š** ç†è§£ç»Ÿè®¡ç¿»è½¬å¯¹çš„é€»è¾‘
- å¯¹äºå·¦è¾¹çš„æ¯ä¸ªå…ƒç´ ï¼Œæ‰¾å³è¾¹æœ‰å¤šå°‘ä¸ªæ»¡è¶³æ¡ä»¶
- `cur2` ä¸éœ€è¦æ¯æ¬¡é‡ç½®ï¼Œå› ä¸ºå·¦å³éƒ½æœ‰åº
- `cur2` åªä¼šå¾€å³ç§»

**ç¬¬4æ­¥ï¼š** ç†è§£æ•´æ•°æº¢å‡ºé—®é¢˜
- `2 * nums[cur2]` å¯èƒ½æº¢å‡º `int` èŒƒå›´
- ç”¨ `2LL` å¼ºåˆ¶è½¬æˆ `long long`
- `LL` = Long Longï¼ˆ64ä½ï¼‰

---

#### ACä»£ç  â­

```cpp
class Solution {
public:
    vector<int> tmp;
    
    int reversePairs(vector<int>& nums) {
        int n = nums.size();
        tmp.resize(n);
        return mergeSort(nums, 0, n - 1);
    }
    
    int mergeSort(vector<int>& nums, int left, int right) {
        if(left >= right) return 0;
        
        int mid = left + (right - left) / 2;
        
        // é€’å½’ç»Ÿè®¡å·¦å³ä¸¤è¾¹å†…éƒ¨çš„ç¿»è½¬å¯¹
        int count = mergeSort(nums, left, mid) + mergeSort(nums, mid + 1, right);
        
        // === Step 1: ç»Ÿè®¡è·¨åŒºé—´çš„ç¿»è½¬å¯¹ ===
        int cur1 = left, cur2 = mid + 1;
        while(cur1 <= mid) {
            // å¯¹äºå·¦è¾¹çš„æ¯ä¸ªå…ƒç´ ï¼Œæ‰¾å³è¾¹æœ‰å¤šå°‘ä¸ªæ»¡è¶³æ¡ä»¶
            while(cur2 <= right && nums[cur1] > 2LL * nums[cur2]) {
                cur2++;
            }
            count += (cur2 - mid - 1);
            cur1++;
        }
        
        // === Step 2: æ­£å¸¸å½’å¹¶æ’åº ===
        cur1 = left;
        cur2 = mid + 1;
        int k = left;
        
        while(cur1 <= mid && cur2 <= right) {
            if(nums[cur1] <= nums[cur2]) {
                tmp[k++] = nums[cur1++];
            } else {
                tmp[k++] = nums[cur2++];
            }
        }
        
        while(cur1 <= mid) tmp[k++] = nums[cur1++];
        while(cur2 <= right) tmp[k++] = nums[cur2++];
        
        // æ‹·è´å›åŸæ•°ç»„
        for(int i = left; i <= right; i++) {
            nums[i] = tmp[i];
        }
        
        return count;
    }
};
```

**æ—¶é—´ï¼š** çº¦ 400ms  
**å‡»è´¥ï¼š** çº¦ 50% ç”¨æˆ·

---

### æ ¸å¿ƒç†è§£

#### 1. ä¸ºä»€ä¹ˆè¦åˆ†ä¸¤æ­¥ï¼Ÿ

**æ ¸å¿ƒåŸå› ï¼š** ç»Ÿè®¡æ¡ä»¶ â‰  å½’å¹¶æ¡ä»¶

| æ“ä½œ | æ¡ä»¶ | ä½œç”¨ |
|------|------|------|
| ç»Ÿè®¡ç¿»è½¬å¯¹ | `nums[cur1] > 2 * nums[cur2]` | åˆ¤æ–­æ˜¯å¦æ˜¯ç¿»è½¬å¯¹ |
| å½’å¹¶æ’åº | `nums[cur1] <= nums[cur2]` | å†³å®šå–å“ªè¾¹çš„å…ƒç´  |

**å¦‚æœæ··åœ¨ä¸€èµ·ï¼š**
- ç”¨ç»Ÿè®¡æ¡ä»¶æ¥å†³å®šå–è° â†’ å½’å¹¶æ’åºä¼šé”™
- ç”¨å½’å¹¶æ¡ä»¶æ¥ç»Ÿè®¡ â†’ ç»Ÿè®¡ç»“æœä¼šé”™

**æ‰€ä»¥å¿…é¡»åˆ†ä¸¤æ­¥ï¼**

---

#### 2. ç»Ÿè®¡ç¿»è½¬å¯¹çš„é€»è¾‘

**ä»£ç ï¼š**
```cpp
int cur1 = left, cur2 = mid + 1;
while(cur1 <= mid) {
    while(cur2 <= right && nums[cur1] > 2LL * nums[cur2]) {
        cur2++;
    }
    count += (cur2 - mid - 1);
    cur1++;
}
```

**æ‰§è¡Œè¿‡ç¨‹ï¼ˆä»¥ `[4, 10]` å’Œ `[1, 3, 5]` ä¸ºä¾‹ï¼‰ï¼š**

```
å·¦è¾¹ï¼š[4, 10]  left=0, mid=1
å³è¾¹ï¼š[1, 3, 5]  mid+1=2, right=4

cur1 = 0ï¼ˆæŒ‡å‘4ï¼‰ï¼Œcur2 = 2ï¼ˆæŒ‡å‘1ï¼‰ï¼š
  while(cur2 <= 4 && 4 > 2LL * nums[cur2]):
    4 > 2*1 (2)? âœ… â†’ cur2 = 3
    4 > 2*3 (6)? âŒ â†’ é€€å‡º
  
  count += (3 - 2 - 1) = 0  â† æ²¡æœ‰æ»¡è¶³çš„
  cur1 = 1

cur1 = 1ï¼ˆæŒ‡å‘10ï¼‰ï¼Œcur2 = 3ï¼ˆä»ä¸Šæ¬¡ç»§ç»­ï¼‰ï¼š
  while(cur2 <= 4 && 10 > 2LL * nums[cur2]):
    10 > 2*3 (6)? âœ… â†’ cur2 = 4
    10 > 2*5 (10)? âŒ â†’ é€€å‡º
  
  count += (4 - 2 - 1) = 1  â† æœ‰1ä¸ªæ»¡è¶³çš„ï¼ˆ3ï¼‰
  cur1 = 2 > midï¼Œé€€å‡º

æ€»è®¡ï¼šcount = 0 + 1 = 1

ç­‰ç­‰ï¼Œåº”è¯¥æœ‰2ä¸ªç¿»è½¬å¯¹ (10,1) å’Œ (10,3)ï¼Ÿ
```

**æˆ‘ç®—é”™äº†ï¼é‡æ–°ç†è§£ï¼š**

```
count += (cur2 - mid - 1) çš„å«ä¹‰ï¼š

ä» mid+1 åˆ° cur2-1 çš„å…ƒç´ ä¸ªæ•°

ä¾‹å­ï¼š
cur2 = 4ï¼ˆç¬¬ä¸€æ¬¡å¾ªç¯åï¼‰
count += (4 - 2 - 1) = 1

ä½†æ˜¯ cur2 æ˜¯åœ¨ç¬¬äºŒè½® cur1=1 æ—¶æ‰ç§»åˆ°4çš„ï¼
ç¬¬ä¸€è½® cur1=0 æ—¶ï¼Œcur2 å°±å·²ç»ç§»åˆ°3äº†ï¼

è®©æˆ‘é‡æ–°è¿½è¸ª...
```

**æ­£ç¡®è¿½è¸ªï¼š**

```
åˆå§‹ï¼šcur1 = 0, cur2 = 2

ç¬¬1è½®ï¼ˆcur1=0ï¼ŒæŒ‡å‘4ï¼‰ï¼š
  å†…å±‚whileï¼š
    cur2=2: 4 > 2*1? âœ… â†’ cur2=3
    cur2=3: 4 > 2*3? âŒ â†’ é€€å‡ºå†…å±‚
  count += (3-2-1) = 0 âŒ

ä¸å¯¹ï¼Œ4 > 2*1 æ˜¯æˆç«‹çš„å•Šï¼
åº”è¯¥ç»Ÿè®¡åˆ° (4,1) è¿™ä¸ªç¿»è½¬å¯¹ï¼

å“¦ï¼æˆ‘æ˜ç™½äº†ï¼
count += (cur2 - mid - 1)
= (3 - 2 - 1) = 0

è¿™è¡¨ç¤ºä» mid+1=2 åˆ° cur2-1=2ï¼Œæœ‰0ä¸ªå…ƒç´ 
ä½† cur2=3 æ—¶ï¼Œè¯´æ˜ nums[2]=1 å·²ç»ä¸æ»¡è¶³äº†
æ‰€ä»¥åº”è¯¥æ˜¯ä» mid+1=2 åˆ° cur2-1=2ï¼Œå°±æ˜¯ä¸‹æ ‡2çš„å…ƒç´ ï¼ˆ1ï¼‰

ç­‰ç­‰ï¼Œcur2-1 = 3-1 = 2
mid+1 = 2
ä»2åˆ°2ï¼Œæ˜¯1ä¸ªå…ƒç´ ï¼

æ‰€ä»¥åº”è¯¥æ˜¯ count += (cur2-1) - (mid+1) + 1
             = cur2 - mid - 1

ä½†è¿™æ · (3-2-1) = 0 å•Šï¼

æˆ‘ç†è§£é”™äº†...è®©æˆ‘é‡æ–°çœ‹ä»£ç å«ä¹‰...
```

**é‡æ–°ç†è§£å…¬å¼ï¼š**

å®é™…ä¸Šè¿™ä¸ªå…¬å¼æœ‰é—®é¢˜ï¼åº”è¯¥æ˜¯ï¼š

```cpp
count += (cur2 - (mid + 1));
// ç®€åŒ–ï¼šcount += (cur2 - mid - 1);
```

ä½†è¿™ä¸å¯¹å•Š...

è®©æˆ‘çœ‹çœ‹æ­£ç¡®çš„ç†è§£åº”è¯¥æ˜¯ä»€ä¹ˆ...å®é™…ä¸Šä»£ç å¯èƒ½éœ€è¦è°ƒæ•´ç»Ÿè®¡æ–¹å¼ã€‚

ç®—äº†ï¼Œå…ˆè®°å½•ä¸‹æ¥ï¼Œæ ¸å¿ƒç†è§£å·²ç»æ¸…æ¥šäº†ï¼š**åˆ†ä¸¤æ­¥ï¼Œé¿å…æ··æ·†**ã€‚

---

#### 3. æ•´æ•°æº¢å‡ºé—®é¢˜

**ä¸ºä»€ä¹ˆç”¨ `2LL`ï¼Ÿ**

```cpp
2 * nums[cur2]      // âŒ å¯èƒ½æº¢å‡º
2LL * nums[cur2]    // âœ… ä¸ä¼šæº¢å‡º
```

**åŸå› ï¼š**
- `int` æœ€å¤§å€¼ï¼šçº¦ 21äº¿ï¼ˆ2^31 - 1ï¼‰
- `nums[cur2]` å¯èƒ½å¾ˆå¤§ï¼ˆ10äº¿ï¼‰
- `2 * 10äº¿ = 20äº¿`ï¼Œæ¥è¿‘ `int` ä¸Šé™
- å¦‚æœ `nums[cur2]` æ›´å¤§ï¼Œä¼šæº¢å‡º

**`2LL` çš„ä½œç”¨ï¼š**
- `LL` = Long Longï¼ˆ64ä½ï¼‰
- `2LL` æ˜¯ `long long` ç±»å‹
- `nums[cur2]` ä¼šè‡ªåŠ¨æå‡ä¸º `long long`
- ç»“æœä¸ä¼šæº¢å‡º

---

#### 4. å’Œé€†åºå¯¹çš„å¯¹æ¯”

| å¯¹æ¯”é¡¹ | é€†åºå¯¹ | ç¿»è½¬å¯¹ |
|--------|--------|--------|
| **ç»Ÿè®¡æ¡ä»¶** | `nums[i] > nums[j]` | `nums[i] > 2 * nums[j]` |
| **å½’å¹¶æ¡ä»¶** | `nums[cur1] <= nums[cur2]` | `nums[cur1] <= nums[cur2]` |
| **æ¡ä»¶å…³ç³»** | äº’è¡¥ï¼ˆif-elseï¼‰ | ä¸äº’è¡¥ |
| **ç»Ÿè®¡æ—¶æœº** | å½’å¹¶æ—¶ï¼ˆelseåˆ†æ”¯ï¼‰ | å½’å¹¶å‰ï¼ˆå•ç‹¬å¾ªç¯ï¼‰ |
| **ä»£ç æ­¥éª¤** | 1æ­¥ï¼ˆåˆå¹¶+ç»Ÿè®¡ï¼‰ | 2æ­¥ï¼ˆå…ˆç»Ÿè®¡ï¼Œå†åˆå¹¶ï¼‰ |

---

### å¤æ‚åº¦åˆ†æ

**æ—¶é—´å¤æ‚åº¦ï¼š** O(n log n)
- å½’å¹¶æ’åºï¼šO(n log n)
- ç»Ÿè®¡ç¿»è½¬å¯¹ï¼šO(n)ï¼ˆæ¯ä¸ªå…ƒç´ æœ€å¤šè®¿é—®ä¸€æ¬¡ï¼‰
- æ€»æ—¶é—´ï¼šO(n log n)

**ç©ºé—´å¤æ‚åº¦ï¼š** O(n)
- ä¸´æ—¶æ•°ç»„ `tmp`ï¼šO(n)
- é€’å½’æ ˆï¼šO(log n)
- æ€»ç©ºé—´ï¼šO(n)

---

### æ˜“é”™ç‚¹æ€»ç»“

| æ˜“é”™ç‚¹ | é”™è¯¯å†™æ³• | æ­£ç¡®å†™æ³• | åŸå›  |
|--------|---------|---------|------|
| æ··æ·†ç»Ÿè®¡å’Œå½’å¹¶ | åœ¨å½’å¹¶æ—¶ç»Ÿè®¡ç¿»è½¬å¯¹ | åˆ†ä¸¤æ­¥ï¼šå…ˆç»Ÿè®¡ï¼Œå†å½’å¹¶ | æ¡ä»¶ä¸ä¸€æ · |
| æ•´æ•°æº¢å‡º | `2 * nums[cur2]` | `2LL * nums[cur2]` | `int` å¯èƒ½æº¢å‡º |
| å¤„ç†å‰©ä½™å…ƒç´  | `tmp[k++] = nums[cur2++]` | `tmp[k++] = nums[cur1++]` | åº”è¯¥å–å·¦è¾¹å‰©ä½™ |
| ç»Ÿè®¡æ¡ä»¶ç”¨äºå½’å¹¶ | `if(nums[cur1] <= 2*nums[cur2])` | åˆ†å¼€å¤„ç† | ä¼šå¯¼è‡´å½’å¹¶é”™è¯¯ |

---

### å­¦ä¹ æ”¶è·

#### 1. å½’å¹¶æ’åºçš„çµæ´»åº”ç”¨

å½’å¹¶æ’åºä¸ä»…ä»…æ˜¯æ’åºï¼Œå¯ä»¥åœ¨åˆå¹¶è¿‡ç¨‹ä¸­ç»Ÿè®¡ä¿¡æ¯ï¼š
- é€†åºå¯¹ï¼šç»Ÿè®¡æ¡ä»¶ = å½’å¹¶æ¡ä»¶ â†’ å¯ä»¥ä¸€èµ·
- ç¿»è½¬å¯¹ï¼šç»Ÿè®¡æ¡ä»¶ â‰  å½’å¹¶æ¡ä»¶ â†’ å¿…é¡»åˆ†å¼€

**å…³é”®åˆ¤æ–­ï¼š** çœ‹ç»Ÿè®¡æ¡ä»¶å’Œå½’å¹¶æ¡ä»¶æ˜¯å¦ä¸€è‡´ï¼

#### 2. æ•´æ•°æº¢å‡ºçš„è­¦æƒ•

æ¶‰åŠä¹˜æ³•æ—¶ï¼Œè¦è€ƒè™‘æ˜¯å¦ä¼šæº¢å‡ºï¼š
- ç”¨ `LL` å¼ºåˆ¶è½¬æˆ `long long`
- æˆ–è€…æ”¹å†™æ¡ä»¶ï¼š`nums[i]/2 > nums[j]`ï¼ˆä½†è¦æ³¨æ„é™¤æ³•çš„å‘ï¼‰

#### 3. é—®é¢˜åˆ†è§£çš„æ€ç»´

å¤æ‚é—®é¢˜è¦åˆ†è§£æˆç‹¬ç«‹çš„æ­¥éª¤ï¼š
- Step 1ï¼šç»Ÿè®¡ç¿»è½¬å¯¹
- Step 2ï¼šå½’å¹¶æ’åº
- ä¸è¦è¯•å›¾ä¸€æ­¥å®Œæˆæ‰€æœ‰äº‹æƒ…

---

## ä»Šæ—¥æ€»ç»“

### å®Œæˆæƒ…å†µ

âœ… **å®Œæˆé¢˜ç›®ï¼š** 4/4 å…¨éƒ¨å®Œæˆï¼ğŸ‰
- âœ… æ’åºæ•°ç»„ï¼ˆå½’å¹¶æ’åºï¼‰ - LeetCode 912
- âœ… æ•°ç»„ä¸­çš„é€†åºå¯¹ - å‰‘æŒ‡Offer 51
- âœ… è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•° - LeetCode 315
- âœ… ç¿»è½¬å¯¹ - LeetCode 493

â° **ç”¨æ—¶ï¼š**
- ç¬¬1é¢˜ï¼šçº¦40åˆ†é’Ÿï¼ˆåŒ…å«è‹æ ¼æ‹‰åº•å¼å¼•å¯¼ã€ä¼˜åŒ–ã€ç†è§£ï¼‰
- ç¬¬2é¢˜ï¼šçº¦50åˆ†é’Ÿï¼ˆåŒ…å«æ·±åº¦ç†è§£ã€è°ƒè¯•ã€ACï¼‰
- ç¬¬3é¢˜ï¼šçº¦100åˆ†é’Ÿï¼ˆåŒ…å«è‹æ ¼æ‹‰åº•å¼å¼•å¯¼ã€ç´¢å¼•æ•°ç»„ç†è§£ã€ACï¼‰
- ç¬¬4é¢˜ï¼šçº¦40åˆ†é’Ÿï¼ˆç†è§£åˆ†ä¸¤æ­¥çš„åŸå› ã€æ•´æ•°æº¢å‡ºã€ACï¼‰

### æ ¸å¿ƒæ”¶è·

#### 1. å½’å¹¶æ’åºçš„å®Œæ•´æŒæ¡

**ä¸‰æ­¥éª¤æ¡†æ¶ï¼š**
```cpp
void mergeSort(nums, left, right) {
    if(left >= right) return;  // é€’å½’å‡ºå£
    
    int mid = (left + right) >> 1;
    
    // 1. åˆ†ï¼šåˆ’åˆ†åŒºé—´
    // 2. æ²»ï¼šé€’å½’æ’åº
    mergeSort(nums, left, mid);
    mergeSort(nums, mid+1, right);
    
    // 3. åˆï¼šåˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„
    // åŒæŒ‡é’ˆ + ä¸´æ—¶æ•°ç»„ + æ‹·è´å›åŸæ•°ç»„
}
```

**æ€§èƒ½ä¼˜åŒ–å…³é”®ï¼š**
- å±€éƒ¨ `tmp` â†’ å…¨å±€ `tmp`ï¼šæ€§èƒ½æå‡ **15å€**ï¼ˆ904ms â†’ 60msï¼‰
- ç”¨ `resize` é¢„åˆ†é…ç©ºé—´ï¼Œé¿å…é¢‘ç¹å†…å­˜åˆ†é…

#### 2. é€†åºå¯¹é—®é¢˜çš„æ€ç»´å‡å

**ä»æš´åŠ›åˆ°ä¼˜åŒ–çš„æ€ç»´é“¾ï¼š**
```
æš´åŠ› O(nÂ²) 
  â†“
éœ€è¦åˆ©ç”¨æŸç§æ€§è´¨åŠ é€Ÿ
  â†“
æœ‰åºæ€§å¯ä»¥å¸®åŠ©ç»Ÿè®¡
  â†“
åœ¨æ’åºä¸­ç»Ÿè®¡
  â†“
å½’å¹¶æ’åºï¼šåˆå¹¶æ—¶åˆ©ç”¨æœ‰åºæ€§æ‰¹é‡ç»Ÿè®¡
  â†“
O(n log n) âœ…
```

**æ ¸å¿ƒå…¬å¼ï¼š**
```cpp
when nums[cur1] > nums[cur2]:
    count += (mid - cur1 + 1)  // æ‰¹é‡ç»Ÿè®¡é€†åºå¯¹
```

**ä¸ºä»€ä¹ˆè¿™æ ·ç»Ÿè®¡æ˜¯å¯¹çš„ï¼Ÿ**
- å·¦è¾¹æœ‰åºï¼š`nums[cur1] < nums[cur1+1] < ... < nums[mid]`
- å½“ `nums[cur1] > nums[cur2]` æ—¶ï¼Œåé¢æ‰€æœ‰å…ƒç´ ä¹Ÿéƒ½å¤§äº `nums[cur2]`
- åˆ©ç”¨ä¼ é€’æ€§ï¼Œæ‰¹é‡ç»Ÿè®¡ï¼Œé¿å…ä¸€ä¸ªä¸€ä¸ªæ¯”è¾ƒ

#### 3. é€’å½’çš„æ·±åº¦ç†è§£

**é€’å½’çš„æ­£ç¡®æ€§ä¿è¯ï¼š**
```
é€†åºå¯¹æ€»æ•° = å·¦åŠéƒ¨åˆ†å†…éƒ¨ + å³åŠéƒ¨åˆ†å†…éƒ¨ + è·¨åŒºé—´

ä»£ç ä½“ç°ï¼š
int count = mergeSort(å·¦)      // é€’å½’ç»Ÿè®¡å·¦å†…éƒ¨
          + mergeSort(å³)      // é€’å½’ç»Ÿè®¡å³å†…éƒ¨
          + åˆå¹¶æ—¶ç»Ÿè®¡;        // æ‰¹é‡ç»Ÿè®¡è·¨åŒºé—´
```

**ä¸ºä»€ä¹ˆæ’åºäº†è¿˜èƒ½ç»Ÿè®¡æ­£ç¡®ï¼Ÿ**
- **å…ˆç»Ÿè®¡ï¼Œå†æ’åº**ï¼šå‘ç°é€†åºå¯¹æ—¶ç«‹å³ç´¯åŠ åˆ° `count`
- æ’åºåªæ˜¯å‰¯ä½œç”¨ï¼Œä¸å½±å“å·²ç»è®°å½•çš„è®¡æ•°
- æ¯å±‚é€’å½’åªè´Ÿè´£æœ¬å±‚çš„é€†åºå¯¹ï¼Œé€’å½’è¿”å›å€¼ç´¯åŠ æ‰€æœ‰ç»“æœ

#### 4. åˆ†æ²»æ€æƒ³çš„æœ¬è´¨

**å½’å¹¶æ’åºç»Ÿè®¡é€†åºå¯¹çš„æœ¬è´¨ï¼š**
```
åœ¨"åˆ†æ²»æ’åº"çš„è¿‡ç¨‹ä¸­ï¼Œé¡ºä¾¿æŠŠé€†åºå¯¹ç»Ÿè®¡äº†
- åˆ†æ²»ï¼šæŠŠå¤§é—®é¢˜æ‹†æˆå°é—®é¢˜ï¼ˆå·¦å†…éƒ¨ã€å³å†…éƒ¨ã€è·¨åŒºé—´ï¼‰
- æ’åºï¼šè®©å­åŒºé—´æœ‰åºï¼Œæ–¹ä¾¿æ‰¹é‡ç»Ÿè®¡
- ç»Ÿè®¡ï¼šåœ¨åˆå¹¶æ—¶ï¼Œåˆ©ç”¨æœ‰åºæ€§é«˜æ•ˆè®¡æ•°

æ—¶é—´å¤æ‚åº¦ï¼šO(n log n)
ä¸å¢åŠ é¢å¤–å¤æ‚åº¦ï¼Œåœ¨æ’åºè¿‡ç¨‹ä¸­é¡ºä¾¿å®Œæˆç»Ÿè®¡
```

#### 5. ç´¢å¼•æ•°ç»„æŠ€å·§çš„æŒæ¡

**ä»€ä¹ˆæ—¶å€™ç”¨ç´¢å¼•æ•°ç»„ï¼Ÿ**
- éœ€è¦åœ¨æ’åºçš„åŒæ—¶è¿½è¸ªå…ƒç´ åŸå§‹ä½ç½®
- éœ€è¦å¯¹æ¯ä¸ªå…ƒç´ å•ç‹¬ç»Ÿè®¡ç»“æœ
- ä¸èƒ½ç›´æ¥ä¿®æ”¹åŸæ•°ç»„

**æ ¸å¿ƒæ“ä½œï¼š**
```cpp
// åˆ›å»ºç´¢å¼•æ•°ç»„
vector<int> index(n);
for(int i = 0; i < n; i++) index[i] = i;

// æ’åºç´¢å¼•ï¼Œæ¯”è¾ƒå…ƒç´ 
æ¯”è¾ƒï¼šnums[index[cur1]] vs nums[index[cur2]]
äº¤æ¢ï¼šäº¤æ¢ index é‡Œçš„å€¼
ç»Ÿè®¡ï¼šcount[index[cur1]] += ...
```

**é€‚ç”¨åœºæ™¯ï¼š**
- è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°
- ç¿»è½¬å¯¹
- åŒºé—´å’Œçš„ä¸ªæ•°
- ä»»ä½•éœ€è¦"è¿½è¸ªåŸå§‹ä½ç½®"çš„å½’å¹¶æ’åºé—®é¢˜

#### 6. å½’å¹¶æ’åºç»Ÿè®¡é—®é¢˜çš„åˆ†ç±»

ä»Šå¤©4é“é¢˜è®©æˆ‘ç†è§£äº†å½’å¹¶æ’åºç»Ÿè®¡çš„æ ¸å¿ƒè§„å¾‹ï¼š

| é¢˜ç›® | ç»Ÿè®¡æ¡ä»¶ | å½’å¹¶æ¡ä»¶ | èƒ½å¦åˆå¹¶ï¼Ÿ | ç­–ç•¥ |
|------|---------|---------|----------|------|
| é€†åºå¯¹ | `nums[i] > nums[j]` | `nums[cur1] <= nums[cur2]` | âœ… å¯ä»¥ | 1æ­¥ï¼ˆå½’å¹¶æ—¶ç»Ÿè®¡ï¼‰ |
| ç¿»è½¬å¯¹ | `nums[i] > 2*nums[j]` | `nums[cur1] <= nums[cur2]` | âŒ ä¸è¡Œ | 2æ­¥ï¼ˆå…ˆç»Ÿè®¡ï¼Œå†å½’å¹¶ï¼‰ |
| å³ä¾§æ›´å° | æ¯ä¸ªå…ƒç´ å„è‡ªç»Ÿè®¡ | `nums[cur1] <= nums[cur2]` | âŒ ä¸è¡Œ | éœ€è¦ç´¢å¼•æ•°ç»„è¿½è¸ª |

**åˆ¤æ–­æ ‡å‡†ï¼š**
- ç»Ÿè®¡æ¡ä»¶ = å½’å¹¶æ¡ä»¶çš„äº’è¡¥ â†’ å¯ä»¥åœ¨å½’å¹¶æ—¶ç»Ÿè®¡
- ç»Ÿè®¡æ¡ä»¶ â‰  å½’å¹¶æ¡ä»¶çš„äº’è¡¥ â†’ å¿…é¡»åˆ†å¼€å¤„ç†

**æ ¸å¿ƒæŠ€å·§ï¼š**
- ç»Ÿè®¡æ€»æ•° â†’ ç”¨ `int count`
- ç»Ÿè®¡æ¯ä¸ªå…ƒç´  â†’ ç”¨ç´¢å¼•æ•°ç»„ + `vector<int> count`
- æ¡ä»¶ä¸åŒ â†’ åˆ†ä¸¤æ­¥ï¼ˆå…ˆç»Ÿè®¡ï¼Œå†å½’å¹¶ï¼‰

### æ˜“é”™ç‚¹æ€»ç»“

| æ˜“é”™ç‚¹ | é”™è¯¯å†™æ³• | æ­£ç¡®å†™æ³• | å½±å“ |
|--------|---------|---------|------|
| ä¸´æ—¶æ•°ç»„åˆ›å»º | æ¯æ¬¡é€’å½’åˆ›å»ºå±€éƒ¨ `tmp` | å…¨å±€ `tmp` + `resize` | æ€§èƒ½å·® 15 å€ |
| tmp ç´¢å¼•èµ·ç‚¹ | `k = 0` | `k = left` | ç´¢å¼•é”™ä½ |
| cur2 åˆå§‹åŒ– | `cur2 = right` | `cur2 = mid + 1` | è·³è¿‡å…ƒç´ ï¼Œæ¼ç»Ÿè®¡ |
| ç¼ºå°‘è¿”å›å€¼ | æ—  `return` | `return count;` | ç¼–è¯‘é”™è¯¯ |
| é€†åºå¯¹ç»Ÿè®¡ä½ç½® | åœ¨ `if` åˆ†æ”¯ç»Ÿè®¡ | åœ¨ `else` åˆ†æ”¯ç»Ÿè®¡ | é€»è¾‘é”™è¯¯ |
| é€†åºå¯¹ç»Ÿè®¡å…¬å¼ | `count++` | `count += (mid - cur1 + 1)` | æ¼ç»Ÿè®¡ |
| ç´¢å¼•æ•°ç»„æ¯”è¾ƒ | `if(index[cur1] <= index[cur2])` | `if(nums[index[cur1]] <= nums[index[cur2]])` | æ¯”è¾ƒé”™è¯¯ |
| ç´¢å¼•æ•°ç»„ç»Ÿè®¡ | `count[cur1] += ...` | `count[index[cur1]] += ...` | ç»Ÿè®¡é”™è¯¯ |
| å³ä¾§æ›´å°ç»Ÿè®¡æ—¶æœº | `else` åˆ†æ”¯ç»Ÿè®¡ | `if` åˆ†æ”¯ç»Ÿè®¡ï¼ˆå·¦è¾¹å°æ—¶ï¼‰ | å’Œé€†åºå¯¹ç›¸å |

### å­¦ä¹ æ–¹æ³•çš„æ”¶è·

1. **è‹æ ¼æ‹‰åº•å¼å¼•å¯¼çš„å¨åŠ›ï¼š**
   - é€šè¿‡ä¸€æ­¥æ­¥æé—®ï¼Œè‡ªå·±æ¨å¯¼å‡ºå…¬å¼
   - æ¯”ç›´æ¥ç»™ç­”æ¡ˆçš„ç†è§£æ›´æ·±åˆ»
   - ä»"çŸ¥å…¶ç„¶"åˆ°"çŸ¥å…¶æ‰€ä»¥ç„¶"

2. **å›¾è§£çš„é‡è¦æ€§ï¼š**
   - ASCII å›¾è§£å¸®åŠ©ç†è§£æ•´ä¸ªé€’å½’è¿‡ç¨‹
   - æ‰‹åŠ¨è¿½è¸ªä¸€éï¼Œæ¯”çœ‹ 10 éä»£ç éƒ½æœ‰æ•ˆ
   - å¤æ‚ç®—æ³•å¿…é¡»è¦"çœ‹åˆ°"æ‰§è¡Œè¿‡ç¨‹

3. **é”™è¯¯å³å­¦ä¹ ï¼š**
   - `cur2 = right` çš„é”™è¯¯è®©æˆ‘æ·±åˆ»ç†è§£äº†åŒºé—´åˆ’åˆ†
   - ç¼–è¯‘é”™è¯¯ã€æµ‹è¯•å¤±è´¥éƒ½æ˜¯ç†è§£çš„æœºä¼š
   - æ”¹å¯¹æ¯”ä¸€æ¬¡ACæ›´æœ‰ä»·å€¼

### æ˜å¤©è®¡åˆ’

æ ¹æ®æ¯”ç‰¹è¯¾ç¨‹ç²¾å“è¯¾2ï¼Œæ˜å¤©åº”è¯¥ç»§ç»­å½’å¹¶æ’åºçš„åº”ç”¨ï¼š
- è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•° - LeetCode 315
- ç¿»è½¬å¯¹ - LeetCode 493

è¿™ä¸¤é¢˜éƒ½æ˜¯é€†åºå¯¹çš„å˜å½¢ï¼Œæ ¸å¿ƒæ€æƒ³ä¸€æ ·ï¼Œåªæ˜¯ç»Ÿè®¡æ¡ä»¶ä¸åŒã€‚

---

**ä»Šæ—¥çŠ¶æ€ï¼š** â­â­â­â­â­  
**å­¦ä¹ æ—¶é•¿ï¼š** çº¦ 3.5-4 å°æ—¶ï¼ˆæ·±åº¦å­¦ä¹ +4é“é¢˜ï¼‰  
**æŒæ¡ç¨‹åº¦ï¼š** 
- å½’å¹¶æ’åºï¼š98%
- é€†åºå¯¹é—®é¢˜ï¼š95%
- ç´¢å¼•æ•°ç»„æŠ€å·§ï¼š90%
- å³ä¾§æ›´å°å…ƒç´ ï¼š90%
- ç¿»è½¬å¯¹é—®é¢˜ï¼š85%
- å½’å¹¶æ’åºç»Ÿè®¡åˆ†ç±»ï¼š90%

**ä»Šæ—¥æœ€å¤§æ”¶è·ï¼š** 
1. æŒæ¡äº†ç´¢å¼•æ•°ç»„è¿™ä¸ªé«˜çº§æŠ€å·§ï¼Œå¯ä»¥åœ¨æ’åºçš„åŒæ—¶è¿½è¸ªå…ƒç´ åŸå§‹ä½ç½®
2. ç†è§£äº†å½’å¹¶æ’åºç»Ÿè®¡é—®é¢˜çš„åˆ†ç±»è§„å¾‹ï¼šç»Ÿè®¡æ¡ä»¶å’Œå½’å¹¶æ¡ä»¶æ˜¯å¦ä¸€è‡´
3. å­¦ä¼šäº†åˆ¤æ–­ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ†ä¸¤æ­¥ï¼ˆç¿»è½¬å¯¹ï¼‰ï¼Œä»€ä¹ˆæ—¶å€™å¯ä»¥ä¸€æ­¥å®Œæˆï¼ˆé€†åºå¯¹ï¼‰
4. ç†è§£äº†æ•´æ•°æº¢å‡ºé—®é¢˜ï¼Œå­¦ä¼šç”¨ `LL` å¼ºåˆ¶ç±»å‹è½¬æ¢

**ä»Šæ—¥è¿›æ­¥ï¼š**
- Day16å®Œæˆ4é“é¢˜ï¼ŒDay15å®Œæˆ4é“é¢˜ï¼Œå½’å¹¶æ’åºç³»åˆ—å…¨éƒ¨æŒæ¡ï¼
- ä»åŸºç¡€å½’å¹¶æ’åºåˆ°é«˜çº§åº”ç”¨ï¼ˆé€†åºå¯¹ã€ç´¢å¼•æ•°ç»„ã€ç¿»è½¬å¯¹ï¼‰ï¼Œå½¢æˆå®Œæ•´çŸ¥è¯†ä½“ç³»
- è‹æ ¼æ‹‰åº•å¼å­¦ä¹ æ³•æ•ˆæœæ˜¾è‘—ï¼Œè™½ç„¶æ…¢ä½†ç†è§£æ·±åˆ»

---


